/* contentbox-filebrowser minified @ Thu Dec 03 2015 15:49:50 */
function fbCKSelect(sPath,sURL,sType){if(!sPath.length||"dir"===sType)return void alert("Please select a file first.");var funcNum=getUrlParam("CKEditorFuncNum");window.opener.CKEDITOR.tools.callFunction(funcNum,sURL),window.close()}function fbGenericClose(){window.close()}function fbTestChoose(path,rPath,type){alert("Path: "+path+"\n URL: "+rPath+"\n Type: "+type)}function fbTestCancel(){alert("Cancel Called")}!function($){function empty(){}jQuery.event.props.push("dataTransfer");var doc_leave_timer,files,default_opts={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:empty,dragStart:empty,dragEnter:empty,dragOver:empty,dragLeave:empty,docEnter:empty,docOver:empty,docLeave:empty,beforeEach:empty,afterAll:empty,rename:empty,error:function(err,file,i,status){alert(err)},uploadStarted:empty,uploadFinished:empty,progressUpdated:empty,globalProgressUpdated:empty,speedUpdated:empty},errors=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],stop_loop=!1,files_count=0;$.fn.filedrop=function(options){function drop(e){return opts.drop.call(this,e)===!1?!1:(files=e.dataTransfer.files,null===files||void 0===files||0===files.length?(opts.error(errors[0]),!1):(files_count=files.length,upload(),e.preventDefault(),!1))}function getBuilder(filename,filedata,mime,boundary){var dashdash="--",crlf="\r\n",builder="";if(opts.data){var params=$.param(opts.data).replace(/\+/g,"%20").split(/&/);$.each(params,function(){var pair=this.split("=",2),name=decodeURIComponent(pair[0]),val=decodeURIComponent(pair[1]);builder+=dashdash,builder+=boundary,builder+=crlf,builder+='Content-Disposition: form-data; name="'+name+'"',builder+=crlf,builder+=crlf,builder+=val,builder+=crlf})}return builder+=dashdash,builder+=boundary,builder+=crlf,builder+='Content-Disposition: form-data; name="'+opts.paramname+'"',builder+='; filename="'+filename+'"',builder+=crlf,builder+="Content-Type: "+mime,builder+=crlf,builder+=crlf,builder+=filedata,builder+=crlf,builder+=dashdash,builder+=boundary,builder+=dashdash,builder+=crlf}function progress(e){if(e.lengthComputable){var percentage=Math.round(100*e.loaded/e.total);if(this.currentProgress!==percentage){this.currentProgress=percentage,opts.progressUpdated(this.index,this.file,this.currentProgress),global_progress[this.global_progress_index]=this.currentProgress,globalProgress();var elapsed=(new Date).getTime(),diffTime=elapsed-this.currentStart;if(diffTime>=opts.refresh){var diffData=e.loaded-this.startData,speed=diffData/diffTime;opts.speedUpdated(this.index,this.file,speed),this.startData=e.loaded,this.currentStart=elapsed}}}}function globalProgress(){if(0!==global_progress.length){var index,total=0;for(index in global_progress)global_progress.hasOwnProperty(index)&&(total+=global_progress[index]);opts.globalProgressUpdated(Math.round(total/global_progress.length))}}function upload(){if(stop_loop=!1,!files)return opts.error(errors[0]),!1;if(opts.allowedfiletypes.push&&opts.allowedfiletypes.length)for(var fileIndex=files.length;fileIndex--;)if(!files[fileIndex].type||$.inArray(files[fileIndex].type,opts.allowedfiletypes)<0)return opts.error(errors[3],files[fileIndex]),!1;var filesDone=0,filesRejected=0;if(files_count>opts.maxfiles&&0===opts.queuefiles)return opts.error(errors[1]),!1;for(var workQueue=[],processingQueue=[],doneQueue=[],i=0;files_count>i;i++)workQueue.push(i);var pause=function(timeout){setTimeout(process,timeout)},process=function(){var fileIndex;if(stop_loop)return!1;if(opts.queuefiles>0&&processingQueue.length>=opts.queuefiles)return pause(opts.queuewait);fileIndex=workQueue[0],workQueue.splice(0,1),processingQueue.push(fileIndex);try{if(beforeEach(files[fileIndex])!==!1){if(fileIndex===files_count)return;var reader=new FileReader,max_file_size=1048576*opts.maxfilesize;if(reader.index=fileIndex,files[fileIndex].size>max_file_size)return opts.error(errors[2],files[fileIndex],fileIndex),processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),filesRejected++,!0;reader.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return opts.error(errors[4]),!1;case e.target.error.NOT_READABLE_ERR:return opts.error(errors[5]),!1;case e.target.error.ABORT_ERR:return opts.error(errors[6]),!1;default:return opts.error(errors[7]),!1}},reader.onloadend=opts.beforeSend?function(e){opts.beforeSend(files[fileIndex],fileIndex,function(){send(e)})}:send,reader.readAsBinaryString(files[fileIndex])}else filesRejected++}catch(err){return processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),opts.error(errors[0]),!1}workQueue.length>0&&process()},send=function(e){var fileIndex=("undefined"==typeof e.srcElement?e.target:e.srcElement).index;void 0===e.target.index&&(e.target.index=getIndexBySize(e.total));var builder,xhr=new XMLHttpRequest,upload=xhr.upload,file=files[e.target.index],index=e.target.index,start_time=(new Date).getTime(),boundary="------multipartformboundary"+(new Date).getTime(),global_progress_index=global_progress.length,newName=rename(file.name),mime=file.type;opts.withCredentials&&(xhr.withCredentials=opts.withCredentials),builder="string"==typeof newName?getBuilder(newName,e.target.result,mime,boundary):getBuilder(file.name,e.target.result,mime,boundary),upload.index=index,upload.file=file,upload.downloadStartTime=start_time,upload.currentStart=start_time,upload.currentProgress=0,upload.global_progress_index=global_progress_index,upload.startData=0,upload.addEventListener("progress",progress,!1),jQuery.isFunction(opts.url)?xhr.open("POST",opts.url(),!0):xhr.open("POST",opts.url,!0),xhr.setRequestHeader("content-type","multipart/form-data; boundary="+boundary),$.each(opts.headers,function(k,v){xhr.setRequestHeader(k,v)}),xhr.sendAsBinary(builder),global_progress[global_progress_index]=0,globalProgress(),opts.uploadStarted(index,file,files_count),xhr.onload=function(){var serverResponse=null;if(xhr.responseText)try{serverResponse=jQuery.parseJSON(xhr.responseText)}catch(e){serverResponse=xhr.responseText}var now=(new Date).getTime(),timeDiff=now-start_time,result=opts.uploadFinished(index,file,serverResponse,timeDiff,xhr);filesDone++,processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),doneQueue.push(fileIndex),global_progress[global_progress_index]=100,globalProgress(),filesDone===files_count-filesRejected&&afterAll(),result===!1&&(stop_loop=!0),(xhr.status<200||xhr.status>299)&&opts.error(xhr.statusText,file,fileIndex,xhr.status)}};process()}function getIndexBySize(size){for(var i=0;files_count>i;i++)if(files[i].size===size)return i}function rename(name){return opts.rename(name)}function beforeEach(file){return opts.beforeEach(file)}function afterAll(){return opts.afterAll()}function dragEnter(e){clearTimeout(doc_leave_timer),e.preventDefault(),opts.dragEnter.call(this,e)}function dragOver(e){clearTimeout(doc_leave_timer),e.preventDefault(),opts.docOver.call(this,e),opts.dragOver.call(this,e)}function dragLeave(e){clearTimeout(doc_leave_timer),opts.dragLeave.call(this,e),e.stopPropagation()}function docDrop(e){return e.preventDefault(),opts.docLeave.call(this,e),!1}function docEnter(e){return clearTimeout(doc_leave_timer),e.preventDefault(),opts.docEnter.call(this,e),!1}function docOver(e){return clearTimeout(doc_leave_timer),e.preventDefault(),opts.docOver.call(this,e),!1}function docLeave(e){doc_leave_timer=setTimeout(function(_this){return function(){opts.docLeave.call(_this,e)}}(this),200)}var opts=$.extend({},default_opts,options),global_progress=[];return this.on("drop",drop).on("dragstart",opts.dragStart).on("dragenter",dragEnter).on("dragover",dragOver).on("dragleave",dragLeave),$(document).on("drop",docDrop).on("dragenter",docEnter).on("dragover",docOver).on("dragleave",docLeave),$("#"+opts.fallback_id).change(function(e){opts.drop(e),files=e.target.files,files_count=files.length,upload()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(datastr){function byteValue(x){return 255&x.charCodeAt(0)}var ords=Array.prototype.map.call(datastr,byteValue),ui8a=new Uint8Array(ords);this.send(ui8a.buffer)}}catch(e){}}(jQuery);var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}},matched=jQuery.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),jQuery.browser=browser,jQuery&&!function(){$.extend($.fn,{contextMenu:function(o,callback){return void 0==o.menu?!1:(void 0==o.inSpeed&&(o.inSpeed=150),void 0==o.outSpeed&&(o.outSpeed=75),0==o.inSpeed&&(o.inSpeed=-1),0==o.outSpeed&&(o.outSpeed=-1),$(this).each(function(){var el=$(this),offset=$(el).offset();$("#"+o.menu).addClass("contextMenu"),$(this).mousedown(function(e){var evt=e;evt.stopPropagation(),$(this).mouseup(function(e){e.stopPropagation();var srcElement=$(this);if($(this).unbind("mouseup"),2==evt.button){$(".contextMenu").hide();var menu=$("#"+o.menu);if($(el).hasClass("disabled"))return!1;var x,y,d={};self.innerHeight?(d.pageYOffset=self.pageYOffset,d.pageXOffset=self.pageXOffset,d.innerHeight=self.innerHeight,d.innerWidth=self.innerWidth):document.documentElement&&document.documentElement.clientHeight?(d.pageYOffset=document.documentElement.scrollTop,d.pageXOffset=document.documentElement.scrollLeft,d.innerHeight=document.documentElement.clientHeight,d.innerWidth=document.documentElement.clientWidth):document.body&&(d.pageYOffset=document.body.scrollTop,d.pageXOffset=document.body.scrollLeft,d.innerHeight=document.body.clientHeight,d.innerWidth=document.body.clientWidth),x=e.pageX?e.pageX:e.clientX+d.scrollLeft,y=e.pageY?e.pageY:e.clientY+d.scrollTop,$(document).unbind("click"),$(menu).css({top:y,left:x}).fadeIn(o.inSpeed),$(menu).find("A").mouseover(function(){$(menu).find("LI.hover").removeClass("hover"),$(this).parent().addClass("hover")}).mouseout(function(){$(menu).find("LI.hover").removeClass("hover")}),$(document).keypress(function(e){switch(e.keyCode){case 38:0==$(menu).find("LI.hover").size()?$(menu).find("LI:last").addClass("hover"):($(menu).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(menu).find("LI.hover").size()&&$(menu).find("LI:last").addClass("hover"));break;case 40:0==$(menu).find("LI.hover").size()?$(menu).find("LI:first").addClass("hover"):($(menu).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(menu).find("LI.hover").size()&&$(menu).find("LI:first").addClass("hover"));break;case 13:$(menu).find("LI.hover A").trigger("click");break;case 27:$(document).trigger("click")}}),$("#"+o.menu).find("A").unbind("click"),$("#"+o.menu).find("LI:not(.disabled) A").click(function(){return $(document).unbind("click").unbind("keypress"),$(".contextMenu").hide(),callback&&callback($(this).attr("href").substr(1),$(srcElement),{x:x-offset.left,y:y-offset.top,docX:x,docY:y}),!1}),setTimeout(function(){$(document).click(function(){return $(document).unbind("click").unbind("keypress"),$(menu).fadeOut(o.outSpeed),!1})},0)}})}),$.browser.mozilla?$("#"+o.menu).each(function(){$(this).css({MozUserSelect:"none"})}):$.browser.msie?$("#"+o.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return!1})}):$("#"+o.menu).each(function(){$(this).bind("mousedown.disableTextSelect",function(){return!1})}),$(el).add($("UL.contextMenu")).bind("contextmenu",function(){return!1})}),$(this))},disableContextMenuItems:function(o){return void 0==o?($(this).find("LI").addClass("disabled"),$(this)):($(this).each(function(){if(void 0!=o)for(var d=o.split(","),i=0;i<d.length;i++)$(this).find('A[href="'+d[i]+'"]').parent().addClass("disabled")}),$(this))},enableContextMenuItems:function(o){return void 0==o?($(this).find("LI.disabled").removeClass("disabled"),$(this)):($(this).each(function(){if(void 0!=o)for(var d=o.split(","),i=0;i<d.length;i++)$(this).find('A[href="'+d[i]+'"]').parent().removeClass("disabled")}),$(this))},disableContextMenu:function(){return $(this).each(function(){$(this).addClass("disabled")}),$(this)},enableContextMenu:function(){return $(this).each(function(){$(this).removeClass("disabled")}),$(this)},destroyContextMenu:function(){return $(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")}),$(this)}})}(jQuery),jQuery.uiDivFilter=function(jq,phrase,ifHidden,ifShown){if(this.last_phrase===phrase)return!1;var phrase_length=phrase.length,words=phrase.toLowerCase().split(" "),search_text=function(){var elem=jQuery(this);jQuery.uiDivFilter.has_words(elem.text(),words)?(elem.show(),ifShown&&ifShown(elem)):(elem.hide(),ifHidden&&ifHidden(elem))};return words.length>1&&phrase.substr(0,phrase_length-1)===this.last_phrase?(words=words[words.length-1],this.last_phrase=phrase,jq.filter(":visible").each(search_text)):(this.last_phrase=phrase,jq.each(search_text)),jq},jQuery.uiDivFilter.last_phrase="",jQuery.uiDivFilter.has_words=function(str,words,caseSensitive){for(var text=caseSensitive?str:str.toLowerCase(),i=0;i<words.length;i++)if(-1===text.indexOf(words[i]))return!1;return!0};