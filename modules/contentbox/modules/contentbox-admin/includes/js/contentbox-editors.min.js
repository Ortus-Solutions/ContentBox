/*! ContentBox Modular CMS. Generated: 13-03-2017 */


function getWidgetSelectorURL(){return $cbEditorConfig.adminEntryURL+"/widgets/editorselector"}function getWidgetPreviewURL(){return $cbEditorConfig.adminEntryURL+"/widgets/preview"}function getWidgetEditorURL(){return $cbEditorConfig.adminEntryURL+"/widgets/editinstance"}function getWidgetInstanceURL(){return $cbEditorConfig.adminEntryURL+"/widgets/viewWidgetInstance"}function getPageSelectorURL(){return $cbEditorConfig.adminEntryURL+"/pages/editorselector"}function getEntrySelectorURL(){return $cbEditorConfig.isBlogDisabled?"":$cbEditorConfig.adminEntryURL+"/entries/editorselector"}function getContentStoreSelectorURL(){return $cbEditorConfig.adminEntryURL+"/contentStore/editorselector"}function getPreviewSelectorURL(){return $cbEditorConfig.adminEntryURL+"/content/preview"}function getAuthorEditorPreferenceURL(){return $cbEditorConfig.adminEntryURL+"/authors/changeEditor"}function getAuthorSavePreferenceURL(){return $cbEditorConfig.adminEntryURL+"/authors/saveSinglePreference"}function getModuleURL(module,event,queryString){var returnURL="";return $.ajax({url:$cbEditorConfig.adminEntryURL+"/modules/buildModuleLink",data:{module:module,moduleEvent:event,moduleQS:queryString},async:!1,success:function(data){returnURL=data}}),$.trim(returnURL)}function loadAssetChooser(callback,w,h){openRemoteModal($cbEditorConfig.adminEntryURL+"/ckFileBrowser/assetChooser?callback="+callback,{},w||"75%",h)}function switchEditor(editorType){confirm("Would you like to save your work before switching editors?")&&($changelog.val("Editor Change Quick Save"),quickSave()),$.ajax({url:getAuthorEditorPreferenceURL(),data:{editor:editorType},async:!1,success:function(data){location.reload()}})}function setupEditors(theForm,withExcerpt,saveURL,collapseNav){$targetEditorForm=theForm,$targetEditorSaveURL=saveURL,$uploaderBarLoader=$targetEditorForm.find("#uploadBarLoader"),$uploaderBarStatus=$targetEditorForm.find("#uploadBarLoaderStatus"),$excerpt=$targetEditorForm.find("#excerpt"),$content=$targetEditorForm.find("#content"),$isPublished=$targetEditorForm.find("#isPublished"),$contentID=$targetEditorForm.find("#contentID"),$changelog=$targetEditorForm.find("#changelog"),$slug=$targetEditorForm.find("#slug"),$withExcerpt=withExcerpt||!0,$wasSubmitted=!1,$cbEditorStartup(),$("[type=date]").datepicker({format:"yyyy-mm-dd"}),$(".datepicker").datepicker({format:"yyyy-mm-dd"}),$targetEditorForm.validate({ignore:"content",submitHandler:function(form){try{updateEditorContent()}catch(err){console.log(err)}if($withExcerpt)try{updateEditorExcerpt()}catch(err){console.log(err)}$content.val().length?($slug.prop("disabled",!1),form.submit()):alert("Please enter some content!")}}),$cbEditorConfig.changelogMandatory&&$changelog.attr("required",$cbEditorConfig.changelogMandatory);var $title=$targetEditorForm.find("#title");$title.on("blur",function(){$slug.prop("disabled")||createPermalink($title.val())}),$slug.on("blur",function(){$(this).prop("disabled")||permalinkUniqueCheck()}),window.onbeforeunload=askLeaveConfirmation,$("#htmlKeywords").keyup(function(){$("#html_keywords_count").html($("#htmlKeywords").val().length)}),$("#htmlDescription").keyup(function(){$("#html_description_count").html($("#htmlDescription").val().length)}),$(".clockpicker").clockpicker(),autoSave($content,$contentID,"contentAutoSave");var bodyEl=$("#container");(collapseNav=collapseNav||!0)&&!$(bodyEl).hasClass("sidebar-mini")&&($("body").removeClass("off-canvas-open"),$(bodyEl).toggleClass("sidebar-mini"))}function quickSave(){if($isPublished.val("false"),$changelog.val().length||$changelog.val("quick save"),!$targetEditorForm.valid())return adminNotifier("error","Form is not valid, please verify."),!1;if(!getEditorContent().length)return void alert("Please enter content before saving.");toggleLoaderBar(),$content.val().length||$content.val(getEditorContent());var disableSlug=!1;$slug.prop("disabled")&&($slug.prop("disabled",!1),disableSlug=!0),$.post($targetEditorSaveURL,$targetEditorForm.serialize(),function(data){$contentID.val(data.CONTENTID),$changelog.val(""),$uploaderBarLoader.fadeOut(1500),$uploaderBarStatus.html("Draft Saved!"),$isPublished.val("true"),disableSlug&&$slug.prop("disabled",!0),adminNotifier("info","Draft Saved!")},"json")}function previewContent(){openRemoteModal(getPreviewSelectorURL(),{content:getEditorContent(),layout:$("#layout").val(),title:$("#title").val(),slug:$slug.val(),contentType:$("#contentType").val(),markup:$("#markup").val(),parentPage:$("#parentPage").val()||""},$(window).width()-50,$(window).height()-200,!0)}function publishNow(){var fullDate=new Date;$("#publishedDate").val(getToday()),$("#publishedHour").val(fullDate.getHours()),$("#publishedMinute").val(fullDate.getMinutes())}function switchMarkup(markupType){$("#markup").val(markupType),$("#markupLabel").html(markupType)}function setWasSubmitted(){$wasSubmitted=!0}function askLeaveConfirmation(){if(checkIsDirty()&&!$wasSubmitted)return"You have unsaved changes."}function permalinkUniqueCheck(linkToUse){var linkToUse=linkToUse||$slug.val();linkToUse=$.trim(linkToUse),linkToUse.length&&$.getJSON($cbEditorConfig.slugCheckURL,{slug:linkToUse,contentID:$("#contentID").val()},function(data){data.UNIQUE?$("#slugCheckErrors").html("").removeClass("alert alert-danger"):$("#slugCheckErrors").html("The permalink slug you entered is already in use, please enter another one or modify it.").addClass("alert alert-danger")})}function createPermalink(linkToUse){var $title=$targetEditorForm.find("#title"),linkToUse=linkToUse||$title.val();linkToUse.length&&(togglePermalink(),$.get($cbEditorConfig.slugifyURL,{slug:linkToUse},function(data){$slug.val(data),permalinkUniqueCheck(),togglePermalink()}))}function togglePermalink(){var toggle=$("#togglePermalink");toggle.hasClass("fa fa-lock")?toggle.attr("class","fa fa-unlock"):toggle.attr("class","fa fa-lock"),$slug.prop("disabled",!$slug.prop("disabled"))}function toggleDraft(){$isPublished.val("false")}function quickPublish(isDraft){isDraft&&toggleDraft(),$cbEditorConfig.changelogMandatory&&!isMainSidebarOpen()&&toggleSidebar(),$targetEditorForm.submit()}function toggleLoaderBar(){$uploaderBarStatus.html("Saving..."),$uploaderBarLoader.slideToggle()}function featuredImageCallback(filePath,fileURL,fileType){$("#featuredImage").val().length&&cancelFeaturedImage(),$("#featuredImageControls").toggleClass("hide"),$("#featuredImage").val(filePath),$("#featuredImageURL").val(fileURL),$("#featuredImagePreview").attr("src",fileURL),closeRemoteModal()}function cancelFeaturedImage(){$("#featuredImage").val(""),$("#featuredImageURL").val(""),$("#featuredImagePreview").attr("src",""),$("#featuredImageControls").toggleClass("hide")}autoSave=function(editor,pageID,ddMenuID,options){if(!Modernizr.localstorage)return $("#"+ddMenuID).find(".autoSaveBtn").html("Auto Save Unavailable").addClass("disabled"),!1;var defaults={storeMax:10,timeout:4e3},opts=$.extend({},defaults,options||{}),editorID=editor.attr("id"),saveStoreKey=(getContentEditor(),"autosave_"+window.location+"_"+editorID),timer=0,savingActive=!1;localStorage.getItem(saveStoreKey)||localStorage.setItem(saveStoreKey,"[]");var saveStore=JSON.parse(localStorage.getItem(saveStoreKey)),removeOldSaves=function(callback){for(var overMax=saveStore.length-opts.storeMax,i=0;i<overMax;i++)localStorage.removeItem(saveStore[i]),saveStore.splice(i,1);callback&&callback()},addToStore=function(saveKey){saveStore.push(saveKey),saveStore.length>opts.storeMax?removeOldSaves(updateAutoSaveMenu):updateAutoSaveMenu()},updateAutoSaveMenu=function(){localStorage.setItem(saveStoreKey,JSON.stringify(saveStore));for(var ulList="",i=saveStore.length;i--;){var newItemDate=moment(saveStore[i].replace(editorID+"_",""),"x"),dateTitle=moment().diff(newItemDate,"hours")<1?newItemDate.fromNow():newItemDate.format("MM/DD/YYYY h:mm a");ulList+='<li><a href="javascript:void(0)" data-id="'+saveStore[i]+'">'+dateTitle+"</a></li>"}saveStore.length||(ulList='<li><a href="javascript:void(0)">No Autosaves, type something :)</a></li>'),$("#"+ddMenuID).find(".autoSaveMenu").html(ulList)},startTimer=function(event){timer&&clearTimeout(timer),timer=setTimeout(onTimer,opts.timeout,event)},onTimer=function(event){if(savingActive)startTimer(event);else{savingActive=!0;var autoSaveKey=editorID+"_"+Date.now();localStorage.setItem(autoSaveKey,LZString.compressToUTF16(getEditorContent())),addToStore(autoSaveKey),savingActive=!1}},loadContent=function(contentID){var content=localStorage.getItem(contentID);setEditorContent("content",LZString.decompressFromUTF16(content)),timer&&clearTimeout(timer)};getContentEditor().on("change",startTimer),$("#"+ddMenuID).on("click","li > a",function(evt){loadContent($(evt.currentTarget).data("id"))}),updateAutoSaveMenu()};
//# sourceMappingURL=contentbox-editors.min.js.map