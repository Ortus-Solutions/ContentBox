/* contentbox-filebrowser minified @ Fri Mar 31 2017 17:10:28 */
function fbCKSelect(sPath,sURL,sType){var getURLParam=function(paramName){var reParam=new RegExp("(?:[?&]|&amp;)"+paramName+"=([^&]+)","i"),match=window.location.search.match(reParam);return match&&match.length>1?match[1]:""};if(!sPath.length||"dir"===sType)return void alert("Please select a file first.");var funcNum=getURLParam("CKEditorFuncNum");window.opener.CKEDITOR.tools.callFunction(funcNum,sURL),window.close()}function fbGenericClose(){window.close()}function fbTestChoose(path,rPath,type){alert("Path: "+path+"\n URL: "+rPath+"\n Type: "+type)}function fbTestCancel(){alert("Cancel Called")}!function($){"use strict";var Jcrop=function(element,opt){var _ua=navigator.userAgent.toLowerCase();this.opt=$.extend({},Jcrop.defaults,opt||{}),this.container=$(element),this.opt.is_msie=/msie/.test(_ua),this.opt.is_ie_lt9=/msie [1-8]\./.test(_ua),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(opt),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};$.extend(Jcrop,{component:{},filter:{},stage:{},registerComponent:function(name,component){Jcrop.component[name]=component},registerFilter:function(name,filter){Jcrop.filter[name]=filter},registerStageType:function(name,stage){Jcrop.stage[name]=stage},attach:function(element,opt){return new $.Jcrop(element,opt)},imgCopy:function(imgel){var img=new Image;return img.src=imgel.src,img},imageClone:function(imgel){return $.Jcrop.supportsCanvas?Jcrop.canvasClone(imgel):Jcrop.imgCopy(imgel)},canvasClone:function(imgel){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");return $(canvas).width(imgel.width).height(imgel.height),canvas.width=imgel.naturalWidth,canvas.height=imgel.naturalHeight,ctx.drawImage(imgel,0,0,imgel.naturalWidth,imgel.naturalHeight),canvas},propagate:function(plist,config,obj){for(var i=0,l=plist.length;i<l;i++)config.hasOwnProperty(plist[i])&&(obj[plist[i]]=config[plist[i]])},getLargestBox:function(ratio,w,h){return w/h>ratio?[h*ratio,h]:[w,w/ratio]},stageConstructor:function(el,options,callback){var stages=[];$.each(Jcrop.stage,function(i,e){stages.push(e)}),stages.sort(function(a,b){return a.priority-b.priority});for(var i=0,l=stages.length;i<l;i++)if(stages[i].isSupported(el,options)){stages[i].create(el,options,function(obj,opt){"function"==typeof callback&&callback(obj,opt)});break}},supportsColorFade:function(){return $.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(xywh){var b={x:xywh[0],y:xywh[1],w:xywh[2],h:xywh[3]};return b.x2=b.x+b.w,b.y2=b.y+b.h,b}});var AbstractStage=function(){};$.extend(AbstractStage,{isSupported:function(el,o){return!0},priority:100,create:function(el,options,callback){var obj=new AbstractStage;obj.element=el,callback.call(this,obj,options)},prototype:{attach:function(core){this.init(core),core.ui.stage=this},triggerEvent:function(ev){return $(this.element).trigger(ev),this},getElement:function(){return this.element}}}),Jcrop.registerStageType("Block",AbstractStage);var ImageStage=function(){};ImageStage.prototype=new AbstractStage,$.extend(ImageStage,{isSupported:function(el,o){if("IMG"==el.tagName)return!0},priority:90,create:function(el,options,callback){$.Jcrop.component.ImageLoader.attach(el,function(w,h){var obj=new ImageStage;obj.element=$(el).wrap("<div />").parent(),obj.element.width(w).height(h),obj.imgsrc=el,"function"==typeof callback&&callback.call(this,obj,options)})}}),Jcrop.registerStageType("Image",ImageStage);var CanvasStage=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};CanvasStage.prototype=new ImageStage,$.extend(CanvasStage,{isSupported:function(el,o){if($.Jcrop.supportsCanvas&&"IMG"==el.tagName)return!0},priority:60,create:function(el,options,callback){var $el=$(el),opt=$.extend({},options);$.Jcrop.component.ImageLoader.attach(el,function(w,h){var obj=new CanvasStage;$el.hide(),obj.createCanvas(el,w,h),$el.before(obj.element),obj.imgsrc=el,opt.imgsrc=el,"function"==typeof callback&&(callback(obj,opt),obj.redraw())})}}),$.extend(CanvasStage.prototype,{init:function(core){this.core=core},setOffset:function(x,y){return this.offset=[x,y],this},setAngle:function(v){return this.angle=v,this},setScale:function(v){return this.scale=this.boundScale(v),this},boundScale:function(v){return v<this.scaleMin?v=this.scaleMin:v>this.scaleMax&&(v=this.scaleMax),v},createCanvas:function(img,w,h){this.width=w,this.height=h,this.canvas=document.createElement("canvas"),this.canvas.width=w,this.canvas.height=h,this.$canvas=$(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgb(0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(w).height(h)},triggerEvent:function(ev){return this.$canvas.trigger(ev),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(v){return this.fillstyle=v,this}}),Jcrop.registerStageType("Canvas",CanvasStage);var BackoffFilter=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};$.extend(BackoffFilter.prototype,{tag:"backoff",priority:22,filter:function(b){var r=this.bound;return b.x<r.minx&&(b.x=r.minx,b.x2=b.w+b.x),b.y<r.miny&&(b.y=r.miny,b.y2=b.h+b.y),b.x2>r.maxx&&(b.x2=r.maxx,b.x=b.x2-b.w),b.y2>r.maxy&&(b.y2=r.maxy,b.y=b.y2-b.h),b},refresh:function(sel){this.elw=sel.core.container.width(),this.elh=sel.core.container.height(),this.bound={minx:0+sel.edge.w,miny:0+sel.edge.n,maxx:this.elw+sel.edge.e,maxy:this.elh+sel.edge.s}}}),Jcrop.registerFilter("backoff",BackoffFilter);var ConstrainFilter=function(){this.core=null};$.extend(ConstrainFilter.prototype,{tag:"constrain",priority:5,filter:function(b,ord){return"move"==ord?(b.x<this.minx&&(b.x=this.minx,b.x2=b.w+b.x),b.y<this.miny&&(b.y=this.miny,b.y2=b.h+b.y),b.x2>this.maxx&&(b.x2=this.maxx,b.x=b.x2-b.w),b.y2>this.maxy&&(b.y2=this.maxy,b.y=b.y2-b.h)):(b.x<this.minx&&(b.x=this.minx),b.y<this.miny&&(b.y=this.miny),b.x2>this.maxx&&(b.x2=this.maxx),b.y2>this.maxy&&(b.y2=this.maxy)),b.w=b.x2-b.x,b.h=b.y2-b.y,b},refresh:function(sel){this.elw=sel.core.container.width(),this.elh=sel.core.container.height(),this.minx=0+sel.edge.w,this.miny=0+sel.edge.n,this.maxx=this.elw+sel.edge.e,this.maxy=this.elh+sel.edge.s}}),Jcrop.registerFilter("constrain",ConstrainFilter);var ExtentFilter=function(){this.core=null};$.extend(ExtentFilter.prototype,{tag:"extent",priority:12,offsetFromCorner:function(corner,box,b){var w=box[0],h=box[1];switch(corner){case"bl":return[b.x2-w,b.y,w,h];case"tl":return[b.x2-w,b.y2-h,w,h];case"br":return[b.x,b.y,w,h];case"tr":return[b.x,b.y2-h,w,h]}},getQuadrant:function(s){var relx=s.opposite[0]-s.offsetx,rely=s.opposite[1]-s.offsety;return relx<0&&rely<0?"br":relx>=0&&rely>=0?"tl":relx<0&&rely>=0?"tr":"bl"},filter:function(b,ord,sel){if("move"==ord)return b;var w=b.w,h=b.h,st=sel.state,r=this.limits,quad=st?this.getQuadrant(st):"br";return r.minw&&w<r.minw&&(w=r.minw),r.minh&&h<r.minh&&(h=r.minh),r.maxw&&w>r.maxw&&(w=r.maxw),r.maxh&&h>r.maxh&&(h=r.maxh),w==b.w&&h==b.h?b:Jcrop.wrapFromXywh(this.offsetFromCorner(quad,[w,h],b))},refresh:function(sel){this.elw=sel.core.container.width(),this.elh=sel.core.container.height(),this.limits={minw:sel.minSize[0],minh:sel.minSize[1],maxw:sel.maxSize[0],maxh:sel.maxSize[1]}}}),Jcrop.registerFilter("extent",ExtentFilter);var GridFilter=function(){this.stepx=1,this.stepy=1,this.core=null};$.extend(GridFilter.prototype,{tag:"grid",priority:19,filter:function(b){var n={x:Math.round(b.x/this.stepx)*this.stepx,y:Math.round(b.y/this.stepy)*this.stepy,x2:Math.round(b.x2/this.stepx)*this.stepx,y2:Math.round(b.y2/this.stepy)*this.stepy};return n.w=n.x2-n.x,n.h=n.y2-n.y,n}}),Jcrop.registerFilter("grid",GridFilter);var RatioFilter=function(){this.ratio=0,this.core=null};$.extend(RatioFilter.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(corner,box,b){var w=box[0],h=box[1];switch(corner){case"bl":return[b.x2-w,b.y,w,h];case"tl":return[b.x2-w,b.y2-h,w,h];case"br":return[b.x,b.y,w,h];case"tr":return[b.x,b.y2-h,w,h]}},getBoundRatio:function(b,quad){var box=Jcrop.getLargestBox(this.ratio,b.w,b.h);return Jcrop.wrapFromXywh(this.offsetFromCorner(quad,box,b))},getQuadrant:function(s){var relx=s.opposite[0]-s.offsetx,rely=s.opposite[1]-s.offsety;return relx<0&&rely<0?"br":relx>=0&&rely>=0?"tl":relx<0&&rely>=0?"tr":"bl"},filter:function(b,ord,sel){if(!this.ratio)return b;var st=(b.w,b.h,sel.state),quad=st?this.getQuadrant(st):"br";if("move"==(ord=ord||"se"))return b;switch(ord){case"n":b.x2=this.elw,b.w=b.x2-b.x,quad="tr";break;case"s":b.x2=this.elw,b.w=b.x2-b.x,quad="br";break;case"e":b.y2=this.elh,b.h=b.y2-b.y,quad="br";break;case"w":b.y2=this.elh,b.h=b.y2-b.y,quad="bl"}return this.getBoundRatio(b,quad)},refresh:function(sel){this.ratio=sel.aspectRatio,this.elw=sel.core.container.width(),this.elh=sel.core.container.height()}}),Jcrop.registerFilter("ratio",RatioFilter);var RoundFilter=function(){this.core=null};$.extend(RoundFilter.prototype,{tag:"round",priority:90,filter:function(b){var n={x:Math.round(b.x),y:Math.round(b.y),x2:Math.round(b.x2),y2:Math.round(b.y2)};return n.w=n.x2-n.x,n.h=n.y2-n.y,n}}),Jcrop.registerFilter("round",RoundFilter);var ShadeFilter=function(opacity,color){this.color=color||"black",this.opacity=opacity||.5,this.core=null,this.shades={}};$.extend(ShadeFilter.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var t=this;t.attached||(t.visible=!1,t.container=$("<div />").addClass(t.core.opt.css_shades).prependTo(this.core.container).hide(),t.elh=this.core.container.height(),t.elw=this.core.container.width(),t.shades={top:t.createShade(),right:t.createShade(),left:t.createShade(),bottom:t.createShade()},t.attached=!0)},destroy:function(){this.container.remove()},setColor:function(color,instant){var t=this;if(color==t.color)return t;this.color=color;var colorfade=Jcrop.supportsColorFade();return $.each(t.shades,function(u,i){t.fade&&!instant&&colorfade?i.animate({backgroundColor:color},{queue:!1,duration:t.fadeSpeed,easing:t.fadeEasing}):i.css("backgroundColor",color)}),t},setOpacity:function(opacity,instant){var t=this;return opacity==t.opacity?t:(t.opacity=opacity,$.each(t.shades,function(u,i){!t.fade||instant?i.css({opacity:opacity}):i.animate({opacity:opacity},{queue:!1,duration:t.fadeSpeed,easing:t.fadeEasing})}),t)},createShade:function(){return $("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(sel){var m=this.core,s=this.shades;this.setColor(sel.bgColor?sel.bgColor:this.core.opt.bgColor),this.setOpacity(sel.bgOpacity?sel.bgOpacity:this.core.opt.bgOpacity),this.elh=m.container.height(),this.elw=m.container.width(),s.right.css("height",this.elh+"px"),s.left.css("height",this.elh+"px")},filter:function(b,ord,sel){if(!sel.active)return b;var t=this,s=t.shades;return s.top.css({left:Math.round(b.x)+"px",width:Math.round(b.w)+"px",height:Math.round(b.y)+"px"}),s.bottom.css({top:Math.round(b.y2)+"px",left:Math.round(b.x)+"px",width:Math.round(b.w)+"px",height:t.elh-Math.round(b.y2)+"px"}),s.right.css({left:Math.round(b.x2)+"px",width:t.elw-Math.round(b.x2)+"px"}),s.left.css({width:Math.round(b.x)+"px"}),t.visible||(t.container.show(),t.visible=!0),b}}),Jcrop.registerFilter("shader",ShadeFilter);var CanvasAnimator=function(stage){this.stage=stage,this.core=stage.core,this.cloneStagePosition()};CanvasAnimator.prototype={cloneStagePosition:function(){var s=this.stage;this.angle=s.angle,this.scale=s.scale,this.offset=s.offset},getElement:function(){var s=this.stage;return $("<div />").css({position:"absolute",top:s.offset[0]+"px",left:s.offset[1]+"px",width:s.angle+"px",height:s.scale+"px"})},animate:function(cb){var t=this;this.scale=this.stage.boundScale(this.scale),t.stage.triggerEvent("croprotstart"),t.getElement().animate({top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"},{easing:t.core.opt.animEasing,duration:t.core.opt.animDuration,complete:function(){t.stage.triggerEvent("croprotend"),"function"==typeof cb&&cb.call(this)},progress:function(anim){var i,props={},tw=anim.tweens;for(i=0;i<tw.length;i++)props[tw[i].prop]=tw[i].now;t.stage.setAngle(props.width).setScale(props.height).setOffset(props.top,props.left).redraw()}})}},Jcrop.stage.Canvas.prototype.getAnimator=function(){return new CanvasAnimator(this)},Jcrop.registerComponent("CanvasAnimator",CanvasAnimator);var CropAnimator=function(selection){this.selection=selection,this.core=selection.core};CropAnimator.prototype={getElement:function(){var b=this.selection.get();return $("<div />").css({position:"absolute",top:b.y+"px",left:b.x+"px",width:b.w+"px",height:b.h+"px"})},animate:function(x,y,w,h,cb){var t=this;t.selection.allowResize(!1),t.getElement().animate({top:y+"px",left:x+"px",width:w+"px",height:h+"px"},{easing:t.core.opt.animEasing,duration:t.core.opt.animDuration,complete:function(){t.selection.allowResize(!0),cb&&cb.call(this)},progress:function(anim){var i,props={},tw=anim.tweens;for(i=0;i<tw.length;i++)props[tw[i].prop]=tw[i].now;var b={x:parseInt(props.left),y:parseInt(props.top),w:parseInt(props.width),h:parseInt(props.height)};b.x2=b.x+b.w,b.y2=b.y+b.h,t.selection.updateRaw(b,"se")}})}},Jcrop.registerComponent("Animator",CropAnimator);var DragState=function(e,selection,ord){var t=this;t.x=e.pageX,t.y=e.pageY,t.selection=selection,t.eventTarget=selection.core.opt.dragEventTarget,t.orig=selection.get(),selection.callFilterFunction("refresh");var p=selection.core.container.position();t.elx=p.left,t.ely=p.top,t.offsetx=0,t.offsety=0,t.ord=ord,t.opposite=t.getOppositeCornerOffset(),t.initEvents(e)};DragState.prototype={getOppositeCornerOffset:function(){var o=this.orig,relx=this.x-this.elx-o.x,rely=this.y-this.ely-o.y;switch(this.ord){case"nw":case"w":return[o.w-relx,o.h-rely];case"sw":return[o.w-relx,-rely];case"se":case"s":case"e":return[-relx,-rely];case"ne":case"n":return[-relx,o.h-rely]}return[null,null]},initEvents:function(e){$(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(e){this.offsetx=e.pageX-this.x,this.offsety=e.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(e){var sel=this.selection;sel.core.container.removeClass("jcrop-dragging"),sel.element.trigger("cropend",[sel,sel.core.unscale(sel.get())]),sel.focus()},createStopHandler:function(){var t=this;return function(e){return $(t.eventTarget).off(".jcrop"),t.endDragEvent(e),!1}},createDragHandler:function(){var t=this;return function(e){return t.dragEvent(e),!1}},update:function(x,y){var t=this;t.offsetx=x-t.x,t.offsety=y-t.y},resultWrap:function(d){var b={x:Math.min(d[0],d[2]),y:Math.min(d[1],d[3]),x2:Math.max(d[0],d[2]),y2:Math.max(d[1],d[3])};return b.w=b.x2-b.x,b.h=b.y2-b.y,b},getBox:function(){var t=this,o=t.orig,_c={x2:o.x+o.w,y2:o.y+o.h};switch(t.ord){case"n":return t.resultWrap([o.x,t.offsety+o.y,_c.x2,_c.y2]);case"s":return t.resultWrap([o.x,o.y,_c.x2,t.offsety+_c.y2]);case"e":return t.resultWrap([o.x,o.y,t.offsetx+_c.x2,_c.y2]);case"w":return t.resultWrap([o.x+t.offsetx,o.y,_c.x2,_c.y2]);case"sw":return t.resultWrap([t.offsetx+o.x,o.y,_c.x2,t.offsety+_c.y2]);case"se":return t.resultWrap([o.x,o.y,t.offsetx+_c.x2,t.offsety+_c.y2]);case"ne":return t.resultWrap([o.x,t.offsety+o.y,t.offsetx+_c.x2,_c.y2]);case"nw":return t.resultWrap([t.offsetx+o.x,t.offsety+o.y,_c.x2,_c.y2]);case"move":return _c.nx=o.x+t.offsetx,_c.ny=o.y+t.offsety,t.resultWrap([_c.nx,_c.ny,_c.nx+o.w,_c.ny+o.h])}}},Jcrop.registerComponent("DragState",DragState);var EventManager=function(core){this.core=core};EventManager.prototype={on:function(n,cb){$(this).on(n,cb)},off:function(n){$(this).off(n)},trigger:function(n){$(this).trigger(n)}},Jcrop.registerComponent("EventManager",EventManager);var ImageLoader=function(src,element,cb){this.src=src,element||(element=new Image),this.element=element,this.callback=cb,this.load()};$.extend(ImageLoader,{attach:function(el,cb){return new ImageLoader(el.src,el,cb)},prototype:{getDimensions:function(){var el=this.element;return el.naturalWidth?[el.naturalWidth,el.naturalHeight]:el.width?[el.width,el.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var t=this;t.element.src=t.src,t.isLoaded()?t.fireCallback():t.element.onload=function(e){t.fireCallback()}}}}),Jcrop.registerComponent("ImageLoader",ImageLoader);var JcropTouch=function(core){this.core=core,this.init()};$.extend(JcropTouch,{support:function(){if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0},prototype:{init:function(){var t=this,p=$.Jcrop.component.DragState.prototype;p.touch||(t.initEvents(),t.shimDragState(),t.shimStageDrag(),p.touch=!0)},shimDragState:function(){var t=this;$.Jcrop.component.DragState.prototype.initEvents=function(e){"touch"==e.type.substr(0,5)?$(this.eventTarget).on("touchmove.jcrop.jcrop-touch",t.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):$(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(cb){return function(e){return e.preventDefault(),e.stopPropagation(),"touch"==e.type.substr(0,5)&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,cb(e))}},initEvents:function(){var t=this,c=t.core;c.container.on("touchstart.jcrop.jcrop-touch","."+c.opt.css_drag,t.dragWrap(c.startDrag()))}}}),Jcrop.registerComponent("Touch",JcropTouch);var KeyWatcher=function(core){this.core=core,this.init()};$.extend(KeyWatcher,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){$.extend(this,KeyWatcher.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var t=this,m=t.core;m.container.on(t.eventName,function(e){var nudge=e.shiftKey?16:2;if($.inArray(e.keyCode,t.passthru)>=0)return!0;switch(e.keyCode){case 37:m.nudge(-nudge,0);break;case 38:m.nudge(0,-nudge);break;case 39:m.nudge(nudge,0);break;case 40:m.nudge(0,nudge);break;case 46:case 8:return m.requestDelete(),!1;default:t.debug&&console.log("keycode: "+e.keyCode)}e.metaKey||e.ctrlKey||e.preventDefault()})}}}),Jcrop.registerComponent("Keyboard",KeyWatcher);var Selection=function(){};$.extend(Selection,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(core){this.core=core,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),core.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var t=this,o=t.core.opt;$.extend(t,Selection.defaults),t.filter=t.core.getDefaultFilters(),t.element=$("<div />").addClass(o.css_selection).data({selection:t}),t.frame=$("<button />").addClass(o.css_button).data("ord","move").attr("type","button"),t.element.append(t.frame).appendTo(t.core.container),t.core.opt.is_msie&&t.frame.css({opacity:0,backgroundColor:"white"}),t.insertElements(),t.frame.on("focus.jcrop",function(e){t.core.setSelection(t),t.element.trigger("cropfocus",t),t.element.addClass("jcrop-focus")}).on("blur.jcrop",function(e){t.element.removeClass("jcrop-focus"),t.element.trigger("cropblur",t)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(opt){return Jcrop.propagate(this.propagate,opt,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(f,args){for(var i=0;i<this.filter.length;i++)this.filter[i][f]&&this.filter[i][f](this);return this},addFilter:function(filter){filter.core=this.core,this.hasFilter(filter)||(this.filter.push(filter),this.sortFilters(),filter.init&&filter.init(),this.refresh())},hasFilter:function(filter){var i,f=this.filter;for(i=0;i<f.length;i++)if(f[i]===filter)return!0},sortFilters:function(){this.filter.sort(function(x,y){return x.priority-y.priority})},clearFilters:function(){for(var i,f=this.filter,i=0;i<f.length;i++)f[i].destroy&&f[i].destroy();this.filter=[]},removeFilter:function(tag){for(var i,f=this.filter,n=[],i=0;i<f.length;i++)f[i].tag&&f[i].tag==tag||tag===f[i]?f[i].destroy&&f[i].destroy():n.push(f[i]);this.filter=n},runFilters:function(b,ord){for(var i=0;i<this.filter.length;i++)b=this.filter[i].filter(b,ord,this);return b},endDrag:function(){this.state&&($(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(e,ord){var t=this;t.core;return ord=ord||$(e.target).data("ord"),this.focus(),("move"!=ord||!t.element.hasClass(t.core.opt.css_nodrag))&&(this.state=new Jcrop.component.DragState(e,this,ord),!1)},allowSelect:function(v){return void 0===v&&(v=this.canSelect),v&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(v){var t=this,o=t.core.opt;return void 0==v&&(v=t.canDrag),v&&t.canDrag?t.element.removeClass(o.css_nodrag):t.element.addClass(o.css_nodrag),this},allowResize:function(v){var t=this,o=t.core.opt;return void 0==v&&(v=t.canResize),v&&t.canResize?t.element.removeClass(o.css_noresize):t.element.addClass(o.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(b){return this.moveTo(b.x,b.y),this.resize(b.w,b.h),this.last=b,this},update:function(b,ord){return this.updateRaw(this.core.scale(b),ord)},updateRaw:function(b,ord){return b=this.runFilters(b,ord),this.redraw(b),this.element.trigger("cropmove",[this,this.core.unscale(b)]),this},animateTo:function(box,cb){var ca=new Jcrop.component.Animator(this),b=this.core.scale(Jcrop.wrapFromXywh(box));ca.animate(b.x,b.y,b.w,b.h,cb)},center:function(instant){var b=this.get(),m=this.core,elw=m.container.width(),elh=m.container.height(),box=[(elw-b.w)/2,(elh-b.h)/2,b.w,b.h];return this[instant?"setSelect":"animateTo"](box)},createElement:function(type,ord){return $("<div />").addClass(type+" ord-"+ord).data("ord",ord)},moveTo:function(x,y){this.element.css({top:y+"px",left:x+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(w,h){this.element.css({width:w+"px",height:h+"px"})},get:function(){var b=this.element,o=b.position(),w=b.width(),h=b.height(),rv={x:o.left,y:o.top};return rv.x2=rv.x+w,rv.y2=rv.y+h,rv.w=w,rv.h=h,rv},insertElements:function(){var i,t=this,fr=(t.core,t.element),o=t.core.opt,b=o.borders,h=o.handles,d=o.dragbars;for(i=0;i<d.length;i++)fr.append(t.createElement(o.css_dragbars,d[i]));for(i=0;i<h.length;i++)fr.append(t.createElement(o.css_handles,h[i]));for(i=0;i<b.length;i++)fr.append(t.createElement(o.css_borders,b[i]))}}}),Jcrop.registerComponent("Selection",Selection);var StageDrag=function(manager,opt){$.extend(this,StageDrag.defaults,opt||{}),this.manager=manager,this.core=manager.core};StageDrag.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},$.extend(StageDrag.prototype,{start:function(e){var c=this.core;if(c.opt.allowSelect){if(c.opt.multi&&c.opt.multiMax&&c.ui.multi.length>=c.opt.multiMax)return!1;var o=$(e.currentTarget).offset(),origx=e.pageX-o.left+this.offset[0],origy=e.pageY-o.top+this.offset[1],m=c.ui.multi;if(!c.opt.multi)if(c.opt.multiCleanup){for(var i=0;i<m.length;i++)m[i].remove();c.ui.multi=[]}else c.removeSelection(c.ui.selection);c.container.addClass("jcrop-dragging");var sel=c.newSelection().updateRaw(Jcrop.wrapFromXywh([origx,origy,1,1]));return sel.element.trigger("cropstart",[sel,this.core.unscale(sel.get())]),sel.startDrag(e,"se")}},end:function(x,y){this.drag(x,y);var b=this.sel.get();this.core.container.removeClass("jcrop-dragging"),b.w<this.minsize[0]||b.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),Jcrop.registerComponent("StageDrag",StageDrag);var StageManager=function(core){this.core=core,this.ui=core.ui,this.init()};$.extend(StageManager.prototype,{init:function(){this.setupEvents(),this.dragger=new StageDrag(this)},tellConfigUpdate:function(options){for(var i=0,m=this.ui.multi,l=m.length;i<l;i++)m[i].setOptions&&(m[i].linked||this.core.opt.linkCurrent&&m[i]==this.ui.selection)&&m[i].setOptions(options)},startDragHandler:function(){var t=this;return function(e){if(!e.button||t.core.opt.is_ie_lt9)return t.dragger.start(e)}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(options){var tmp,core=this.core;$.each(core.opt.legacyHandlers,function(k,i){k in options&&(tmp=options[k],core.container.off(".jcrop-"+k).on(i+".jcrop.jcrop-"+k,function(e,s,c){tmp.call(core,c)}),delete options[k])})},setupEvents:function(){var t=this,c=t.core;c.event.on("configupdate.jcrop-stage",function(e){t.shimLegacyHandlers(c.opt),t.tellConfigUpdate(c.opt),c.container.trigger("cropconfig",[c,c.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),Jcrop.registerComponent("StageManager",StageManager);var Thumbnailer=function(){};$.extend(Thumbnailer,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var s=this.core.ui.stage,cxt=s.context;this.context.putImageData(cxt.getImageData(0,0,s.canvas.width,s.canvas.height),0,0)},init:function(core,options){var t=this;this.core=core,$.extend(this,Thumbnailer.defaults,options),t.initEvents(),t.refresh(),t.insertElements(),t.selection?(t.renderSelection(t.selection),t.selectionTarget=t.selection.element[0]):t.core.ui.selection&&t.renderSelection(t.core.ui.selection),t.core.ui.stage.canvas&&(t.context=t.preview[0].getContext("2d"),t.core.container.on("cropredraw",function(e){t.recopyCanvas(),t.refresh()}))},updateImage:function(imgel){return this.preview.remove(),this.preview=$($.Jcrop.imageClone(imgel)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=$($.Jcrop.imageClone(this.core.ui.stage.imgsrc)),this.element=$("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(w,h){this.width=w,this.height=h,this.element.width(w).height(h),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(c){var rx=this.width/c.w,ry=this.height/c.h;return this.preview.css({width:Math.round(rx*this.cw)+"px",height:Math.round(ry*this.ch)+"px",marginLeft:"-"+Math.round(rx*c.x)+"px",marginTop:"-"+Math.round(ry*c.y)+"px"}),this.last=c,this},renderSelection:function(s){return this.renderCoords(s.core.unscale(s.get()))},selectionStart:function(s){this.renderSelection(s)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var t=this;t.fading?t._hiding=setTimeout(function(){t._hiding=null,t.element.stop().animate({opacity:0},{duration:t.fadeDuration,queue:!1})},t.fadeDelay):t.element.hide()},initEvents:function(){var t=this;t.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(e,s,c){if(t.selectionTarget&&t.selectionTarget!==e.target)return!1;switch(e.type){case"cropimage":t.updateImage(c);break;case"cropstart":t.selectionStart(s);case"croprotstart":t.show();break;case"cropend":t.renderCoords(c);case"croprotend":t.autoHide&&t.hide();break;case"cropmove":t.renderCoords(c)}})}}}),Jcrop.registerComponent("Thumbnailer",Thumbnailer);var DialDrag=function(){};DialDrag.prototype={init:function(core,actuator,callback){actuator||(actuator=core.container),this.$btn=$(actuator),this.$targ=$(actuator),this.core=core,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),$.isFunction(callback)||(callback=function(){}),this.callback=callback,this.ondone=callback},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(obj){return this.$targ=$(obj),this},getOffset:function(){var targ=this.$targ,pos=targ.offset();return[pos.left+targ.width()/2,pos.top+targ.height()/2]},relMouse:function(e){var x=e.pageX-this.offset[0],y=e.pageY-this.offset[1];return[x,y,Math.atan2(y,x)*(180/Math.PI),Math.sqrt(Math.pow(x,2)+Math.pow(y,2))]},mousedown:function(){function mouseUp(e){$(window).off(".dialdrag"),that.ondone.call(that,that.relMouse(e)),that.core.container.trigger("croprotend")}function mouseMove(e){that.callback.call(that,that.relMouse(e))}var that=this;return function(e){that.offset=that.getOffset();var rel=that.relMouse(e);return that.angleOffset=-that.core.ui.stage.angle+rel[2],that.distOffset=rel[3],that.dragOffset=[rel[0],rel[1]],that.core.container.trigger("croprotstart"),$(window).on("mousemove.dialdrag",mouseMove).on("mouseup.dialdrag",mouseUp),that.callback.call(that,that.relMouse(e)),!1}}},Jcrop.registerComponent("DialDrag",DialDrag),Jcrop.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:Jcrop.component.EventManager,keyboardComponent:Jcrop.component.Keyboard,dragstateComponent:Jcrop.component.DragState,stagemanagerComponent:Jcrop.component.StageManager,animatorComponent:Jcrop.component.Animator,selectionComponent:Jcrop.component.Selection,stageConstructor:Jcrop.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},$.extend(Jcrop.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),
$.Jcrop.supportsTouch&&new $.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var o=this.opt,img=this.opt.imgsrc;if(img){var iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height,bw=o.boxWidth||iw,bh=o.boxHeight||ih;if(img&&(iw>bw||ih>bh)){var bx=Jcrop.getLargestBox(iw/ih,bw,bh);$(img).width(bx[0]).height(bx[1]),this.resizeContainer(bx[0],bx[1]),this.opt.xscale=iw/bx[0],this.opt.yscale=ih/bx[1]}}if(this.opt.trueSize){var dw=this.opt.trueSize[0],dh=this.opt.trueSize[1],cs=this.getContainerSize();this.opt.xscale=dw/cs[0],this.opt.yscale=dh/cs[1]}},initComponent:function(name){if(Jcrop.component[name]){var args=Array.prototype.slice.call(arguments),obj=new Jcrop.component[name];return args.shift(),args.unshift(this),obj.init.apply(obj,args),obj}},setOptions:function(opt,proptype){return $.isPlainObject(opt)||(opt={}),$.extend(this.opt,opt),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),$(this.opt.imgsrc).removeData("Jcrop").show()):this.container.remove()},applyFilters:function(){for(var obj,i=0,f=this.opt.applyFilters,l=f.length;i<l;i++)$.Jcrop.filter[f[i]]&&(obj=new $.Jcrop.filter[f[i]]),obj.core=this,obj.init&&obj.init(),this.filter[f[i]]=obj},getDefaultFilters:function(){for(var rv=[],i=0,f=this.opt.applyFilters,l=f.length;i<l;i++)this.filter.hasOwnProperty(f[i])&&rv.push(this.filter[f[i]]);return rv.sort(function(x,y){return x.priority-y.priority}),rv},setSelection:function(sel){for(var m=this.ui.multi,n=[],i=0;i<m.length;i++)m[i]!==sel&&n.push(m[i]),m[i].toBack();return n.unshift(sel),this.ui.multi=n,this.ui.selection=sel,sel.toFront(),sel},getSelection:function(raw){return this.ui.selection.get()},newSelection:function(sel){return sel||(sel=new this.opt.selectionComponent),sel.init(this),this.setSelection(sel),sel},hasSelection:function(sel){for(var i=0;i<this.ui.multi;i++)if(sel===this.ui.multi[i])return!0},removeSelection:function(sel){for(var i,n=[],m=this.ui.multi,i=0;i<m.length;i++)sel!==m[i]?n.push(m[i]):m[i].remove();return this.ui.multi=n},addFilter:function(filter){for(var i=0,m=this.ui.multi,l=m.length;i<l;i++)m[i].addFilter(filter);return this},removeFilter:function(filter){for(var i=0,m=this.ui.multi,l=m.length;i<l;i++)m[i].removeFilter(filter);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){var t=this;t.container.on("selectstart",function(e){return!1}).on("mousedown","."+t.opt.css_drag,t.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(x,y){var s=this.ui.selection,b=s.get();b.x+=x,b.x2+=x,b.y+=y,b.y2+=y,b.x<0?(b.x2=b.w,b.x=0):b.x2>this.elw&&(b.x2=this.elw,b.x=b.x2-b.w),b.y<0?(b.y2=b.h,b.y=0):b.y2>this.elh&&(b.y2=this.elh,b.y=b.y2-b.h),s.element.trigger("cropstart",[s,this.unscale(b)]),s.updateRaw(b,"move"),s.element.trigger("cropend",[s,this.unscale(b)])},refresh:function(){for(var i=0,s=this.ui.multi,l=s.length;i<l;i++)s[i].refresh()},blurAll:function(){for(var m=this.ui.multi,i=0;i<m.length;i++)m[i]!==sel&&n.push(m[i]),m[i].toBack()},scale:function(b){var xs=this.opt.xscale,ys=this.opt.yscale;return{x:b.x/xs,y:b.y/ys,x2:b.x2/xs,y2:b.y2/ys,w:b.w/xs,h:b.h/ys}},unscale:function(b){var xs=this.opt.xscale,ys=this.opt.yscale;return{x:b.x*xs,y:b.y*ys,x2:b.x2*xs,y2:b.y2*ys,w:b.w*xs,h:b.h*ys}},requestDelete:function(){if(this.ui.multi.length>1&&this.ui.selection.canDelete)return this.deleteSelection()},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(box){return this.ui.selection&&this.ui.selection.animateTo(box),this},setSelect:function(box){return this.ui.selection&&this.ui.selection.update(Jcrop.wrapFromXywh(box)),this},startDrag:function(){var t=this;return function(e){var $targ=$(e.target),selection=$targ.closest("."+t.opt.css_selection).data("selection"),ord=$targ.data("ord");return t.container.trigger("cropstart",[selection,t.unscale(selection.get())]),selection.startDrag(e,ord),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(w,h){this.container.width(w).height(h),this.refresh()},setImage:function(src,cb){var t=this,targ=t.opt.imgsrc;if(!targ)return!1;new $.Jcrop.component.ImageLoader(src,null,function(w,h){t.resizeContainer(w,h),targ.src=src,$(targ).width(w).height(h),t.applySizeConstraints(),t.refresh(),t.container.trigger("cropimage",[t,targ]),"function"==typeof cb&&cb.call(t,w,h)})},update:function(b){this.ui.selection&&this.ui.selection.update(b)}}),$.fn.Jcrop=function(options,callback){options=options||{};var first=this.eq(0).data("Jcrop"),args=Array.prototype.slice.call(arguments);return"api"==options?first:first&&"string"==typeof options?!!first[options]&&(args.shift(),first[options].apply(first,args),first):void this.each(function(){var $t=$(this),exists=$t.data("Jcrop");return exists?exists.setOptions(options):(options.stageConstructor||(options.stageConstructor=$.Jcrop.stageConstructor),options.stageConstructor(this,options,function(stage,options){var selection=options.setSelect;selection&&delete options.setSelect;var obj=$.Jcrop.attach(stage.element,options);"function"==typeof stage.attach&&stage.attach(obj),$t.data("Jcrop",obj),selection&&(obj.newSelection(),obj.setSelect(selection)),"function"==typeof callback&&callback.call(obj)})),this})};var Modernizr=function(window,document,undefined){function setCss(str){mStyle.cssText=str}function is(obj,type){return typeof obj===type}function contains(str,substr){return!!~(""+str).indexOf(substr)}function testProps(props,prefixed){for(var i in props){var prop=props[i];if(!contains(prop,"-")&&mStyle[prop]!==undefined)return"pfx"!=prefixed||prop}return!1}function testDOMProps(props,obj,elem){for(var i in props){var item=obj[props[i]];if(item!==undefined)return elem===!1?props[i]:is(item,"function")?item.bind(elem||obj):item}return!1}function testPropsAll(prop,prefixed,elem){var ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+" "+cssomPrefixes.join(ucProp+" ")+ucProp).split(" ");return is(prefixed,"string")||is(prefixed,"undefined")?testProps(props,prefixed):(props=(prop+" "+domPrefixes.join(ucProp+" ")+ucProp).split(" "),testDOMProps(props,prefixed,elem))}var featureName,hasOwnProp,version="2.7.1",Modernizr={},docElement=document.documentElement,mod="modernizr",modElem=document.createElement(mod),mStyle=modElem.style,toString={}.toString,prefixes=" -webkit- -moz- -o- -ms- ".split(" "),omPrefixes="Webkit Moz O ms",cssomPrefixes=omPrefixes.split(" "),domPrefixes=omPrefixes.toLowerCase().split(" "),ns={svg:"http://www.w3.org/2000/svg"},tests={},classes=[],slice=classes.slice,injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,docOverflow,div=document.createElement("div"),body=document.body,fakeBody=body||document.createElement("body");if(parseInt(nodes,10))for(;nodes--;)node=document.createElement("div"),node.id=testnames?testnames[nodes]:mod+(nodes+1),div.appendChild(node);return style=["&#173;",'<style id="s',mod,'">',rule,"</style>"].join(""),div.id=mod,(body?div:fakeBody).innerHTML+=style,fakeBody.appendChild(div),body||(fakeBody.style.background="",fakeBody.style.overflow="hidden",docOverflow=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(fakeBody)),ret=callback(div,rule),body?div.parentNode.removeChild(div):(fakeBody.parentNode.removeChild(fakeBody),docElement.style.overflow=docOverflow),!!ret},isEventSupported=function(){function isEventSupported(eventName,element){element=element||document.createElement(TAGNAMES[eventName]||"div"),eventName="on"+eventName;var isSupported=eventName in element;return isSupported||(element.setAttribute||(element=document.createElement("div")),element.setAttribute&&element.removeAttribute&&(element.setAttribute(eventName,""),isSupported=is(element[eventName],"function"),is(element[eventName],"undefined")||(element[eventName]=undefined),element.removeAttribute(eventName))),element=null,isSupported}var TAGNAMES={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return isEventSupported}(),_hasOwnProperty={}.hasOwnProperty;hasOwnProp=is(_hasOwnProperty,"undefined")||is(_hasOwnProperty.call,"undefined")?function(object,property){return property in object&&is(object.constructor.prototype[property],"undefined")}:function(object,property){return _hasOwnProperty.call(object,property)},Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError;var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return target.apply(that,args.concat(slice.call(arguments)))};return bound}),tests.canvas=function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))},tests.canvastext=function(){return!(!Modernizr.canvas||!is(document.createElement("canvas").getContext("2d").fillText,"function"))},tests.touch=function(){var bool;return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?bool=!0:injectElementWithStyles(["@media (",prefixes.join("touch-enabled),("),mod,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(node){bool=9===node.offsetTop}),bool},tests.draganddrop=function(){var div=document.createElement("div");return"draggable"in div||"ondragstart"in div&&"ondrop"in div},tests.csstransforms=function(){return!!testPropsAll("transform")},tests.svg=function(){return!!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect},tests.inlinesvg=function(){var div=document.createElement("div");return div.innerHTML="<svg/>",(div.firstChild&&div.firstChild.namespaceURI)==ns.svg},tests.svgclippaths=function(){return!!document.createElementNS&&/SVGClipPath/.test(toString.call(document.createElementNS(ns.svg,"clipPath")))};for(var feature in tests)hasOwnProp(tests,feature)&&(featureName=feature.toLowerCase(),Modernizr[featureName]=tests[feature](),classes.push((Modernizr[featureName]?"":"no-")+featureName));return Modernizr.addTest=function(feature,test){if("object"==typeof feature)for(var key in feature)hasOwnProp(feature,key)&&Modernizr.addTest(key,feature[key]);else{if(feature=feature.toLowerCase(),Modernizr[feature]!==undefined)return Modernizr;test="function"==typeof test?test():test,"undefined"!=typeof enableClasses&&enableClasses&&(docElement.className+=" "+(test?"":"no-")+feature),Modernizr[feature]=test}return Modernizr},setCss(""),modElem=null,Modernizr._version=version,Modernizr._prefixes=prefixes,Modernizr._domPrefixes=domPrefixes,Modernizr._cssomPrefixes=cssomPrefixes,Modernizr.hasEvent=isEventSupported,Modernizr.testProp=function(prop){return testProps([prop])},Modernizr.testAllProps=testPropsAll,Modernizr.testStyles=injectElementWithStyles,Modernizr}(window,window.document);!function(){var datauri=new Image;datauri.onerror=function(){Modernizr.addTest("datauri",function(){return!1})},datauri.onload=function(){Modernizr.addTest("datauri",function(){return 1==datauri.width&&1==datauri.height})},datauri.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}(),$.Jcrop=Jcrop,$.Jcrop.supportsCanvas=Modernizr.canvas,$.Jcrop.supportsCanvasText=Modernizr.canvastext,$.Jcrop.supportsDragAndDrop=Modernizr.draganddrop,$.Jcrop.supportsDataURI=Modernizr.datauri,$.Jcrop.supportsSVG=Modernizr.svg,$.Jcrop.supportsInlineSVG=Modernizr.inlinesvg,$.Jcrop.supportsSVGClipPaths=Modernizr.svgclippaths,$.Jcrop.supportsCSSTransforms=Modernizr.csstransforms,$.Jcrop.supportsTouch=Modernizr.touch}(jQuery),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){"use strict";function splitAccesskey(val){for(var k,t=val.split(/\s+/),keys=[],i=0;k=t[i];i++)k=k.charAt(0).toUpperCase(),keys.push(k);return keys}function inputLabel(node){return node.id&&$('label[for="'+node.id+'"]').val()||node.name}function menuChildren(items,$children,counter){return counter||(counter=0),$children.each(function(){var label,item,$node=$(this),node=this,nodeName=this.nodeName.toLowerCase();switch("label"===nodeName&&$node.find("input, textarea, select").length&&(label=$node.text(),$node=$node.children().first(),node=$node.get(0),nodeName=node.nodeName.toLowerCase()),nodeName){case"menu":item={name:$node.attr("label"),items:{}},counter=menuChildren(item.items,$node.children(),counter);break;case"a":case"button":item={name:$node.text(),disabled:!!$node.attr("disabled"),callback:function(){return function(){$node.click()}}()};break;case"menuitem":case"command":switch($node.attr("type")){case void 0:case"command":case"menuitem":item={name:$node.attr("label"),disabled:!!$node.attr("disabled"),icon:$node.attr("icon"),callback:function(){return function(){$node.click()}}()};break;case"checkbox":item={type:"checkbox",disabled:!!$node.attr("disabled"),name:$node.attr("label"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",disabled:!!$node.attr("disabled"),name:$node.attr("label"),radio:$node.attr("radiogroup"),value:$node.attr("id"),selected:!!$node.attr("checked")};break;default:item=void 0}break;case"hr":item="-------";break;case"input":switch($node.attr("type")){case"text":item={type:"text",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"checkbox":item={type:"checkbox",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),radio:!!$node.attr("name"),value:$node.val(),selected:!!$node.attr("checked")};break;default:item=void 0}break;case"select":item={type:"select",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:$node.val(),options:{}},$node.children().each(function(){item.options[this.value]=$(this).text()});break;case"textarea":item={type:"textarea",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"label":break;default:item={type:"html",html:$node.clone(!0)}}item&&(counter++,items["key"+counter]=item)}),counter}$.support.htmlMenuitem="HTMLMenuItemElement"in window,$.support.htmlCommand="HTMLCommandElement"in window,$.support.eventSelectstart="onselectstart"in document.documentElement,$.ui&&$.widget||($.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;null!=elems[i];i++){elem=elems[i];try{events=$._data(elem,"events"),events&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}}orig(elems)}}($.cleanData));var $currentTrigger=null,initialized=!1,$win=$(window),counter=0,namespaces={},menus={},types={},defaults={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function($menu){if($.ui&&$.ui.position)$menu.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var offset=this.offset();offset.top+=this.outerHeight(),offset.left+=this.outerWidth()/2-$menu.outerWidth()/2,$menu.css(offset)}},position:function(opt,x,y){var offset;if(!x&&!y)return void opt.determinePosition.call(this,opt.$menu);offset="maintain"===x&&"maintain"===y?opt.$menu.position():{top:y,left:x};var bottom=$win.scrollTop()+$win.height(),right=$win.scrollLeft()+$win.width(),height=opt.$menu.outerHeight(),width=opt.$menu.outerWidth();offset.top+height>bottom&&(offset.top-=height),offset.top<0&&(offset.top=0),offset.left+width>right&&(offset.left-=width),offset.left<0&&(offset.left=0),opt.$menu.css(offset)},positionSubmenu:function($menu){if(void 0!==$menu)if($.ui&&$.ui.position)$menu.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var offset={top:-9,left:this.outerWidth()-5};$menu.css(offset)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:$.noop,hide:$.noop},callback:null,items:{}},hoveract={timer:null,pageX:null,pageY:null},zindex=function($t){for(var zin=0,$tt=$t;;)if(zin=Math.max(zin,parseInt($tt.css("z-index"),10)||0),!($tt=$tt.parent())||!$tt.length||"html body".indexOf($tt.prop("nodeName").toLowerCase())>-1)break;return zin},handle={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(e){var $this=$(this);if("right"===e.data.trigger&&(e.preventDefault(),e.stopImmediatePropagation()),!("right"!==e.data.trigger&&"demand"!==e.data.trigger&&e.originalEvent||!(void 0===e.mouseButton||!e.data||"left"===e.data.trigger&&0===e.mouseButton||"right"===e.data.trigger&&2===e.mouseButton)||$this.hasClass("context-menu-active")||$this.hasClass("context-menu-disabled"))){if($currentTrigger=$this,e.data.build){var built=e.data.build($currentTrigger,e);if(built===!1)return;if(e.data=$.extend(!0,{},defaults,e.data,built||{}),!e.data.items||$.isEmptyObject(e.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");e.data.$trigger=$currentTrigger,op.create(e.data)}var showMenu=!1;for(var item in e.data.items)if(e.data.items.hasOwnProperty(item)){var visible;visible=$.isFunction(e.data.items[item].visible)?e.data.items[item].visible.call($(e.currentTarget),item,e.data):void 0===e.data.items[item]||!e.data.items[item].visible||e.data.items[item].visible===!0,visible&&(showMenu=!0)}showMenu&&op.show.call($this,e.data,e.pageX,e.pageY)}},click:function(e){e.preventDefault(),e.stopImmediatePropagation(),$(this).trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var $this=$(this);$currentTrigger&&$currentTrigger.length&&!$currentTrigger.is($this)&&$currentTrigger.data("contextMenu").$menu.trigger("contextmenu:hide"),2===e.button&&($currentTrigger=$this.data("contextMenuActive",!0))},mouseup:function(e){var $this=$(this);$this.data("contextMenuActive")&&$currentTrigger&&$currentTrigger.length&&$currentTrigger.is($this)&&!$this.hasClass("context-menu-disabled")&&(e.preventDefault(),e.stopImmediatePropagation(),$currentTrigger=$this,$this.trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))),$this.removeData("contextMenuActive")},mouseenter:function(e){var $this=$(this),$related=$(e.relatedTarget),$document=$(document);$related.is(".context-menu-list")||$related.closest(".context-menu-list").length||$currentTrigger&&$currentTrigger.length||(hoveract.pageX=e.pageX,hoveract.pageY=e.pageY,hoveract.data=e.data,$document.on("mousemove.contextMenuShow",handle.mousemove),hoveract.timer=setTimeout(function(){hoveract.timer=null,$document.off("mousemove.contextMenuShow"),$currentTrigger=$this,$this.trigger($.Event("contextmenu",{data:hoveract.data,pageX:hoveract.pageX,pageY:hoveract.pageY}))},e.data.delay))},mousemove:function(e){hoveract.pageX=e.pageX,hoveract.pageY=e.pageY},mouseleave:function(e){var $related=$(e.relatedTarget);if(!$related.is(".context-menu-list")&&!$related.closest(".context-menu-list").length){try{clearTimeout(hoveract.timer)}catch(e){}hoveract.timer=null}},layerClick:function(e){var target,offset,$this=$(this),root=$this.data("contextMenuRoot"),button=e.button,x=e.pageX,y=e.pageY;e.preventDefault(),e.stopImmediatePropagation(),setTimeout(function(){var $window,triggerAction="left"===root.trigger&&0===button||"right"===root.trigger&&2===button;if(document.elementFromPoint&&root.$layer){if(root.$layer.hide(),target=document.elementFromPoint(x-$win.scrollLeft(),y-$win.scrollTop()),target.isContentEditable){var range=document.createRange(),sel=window.getSelection();range.selectNode(target),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range)}root.$layer.show()}if(root.reposition&&triggerAction)if(document.elementFromPoint){if(root.$trigger.is(target)||root.$trigger.has(target).length)return void root.position.call(root.$trigger,root,x,y)}else if(offset=root.$trigger.offset(),$window=$(window),offset.top+=$window.scrollTop(),offset.top<=e.pageY&&(offset.left+=$window.scrollLeft(),offset.left<=e.pageX&&(offset.bottom=offset.top+root.$trigger.outerHeight(),offset.bottom>=e.pageY&&(offset.right=offset.left+root.$trigger.outerWidth(),offset.right>=e.pageX))))return void root.position.call(root.$trigger,root,x,y);target&&triggerAction&&root.$trigger.one("contextmenu:hidden",function(){$(target).contextMenu({x:x,y:y,button:button})}),null!==root&&void 0!==root&&null!==root.$menu&&void 0!==root.$menu&&root.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,opt){opt.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var opt={};$currentTrigger&&(opt=$currentTrigger.data("contextMenu")||{}),void 0===opt.zIndex&&(opt.zIndex=0);var targetZIndex=0,getZIndexOfTriggerTarget=function(target){""!==target.style.zIndex?targetZIndex=target.style.zIndex:null!==target.offsetParent&&void 0!==target.offsetParent?getZIndexOfTriggerTarget(target.offsetParent):null!==target.parentElement&&void 0!==target.parentElement&&getZIndexOfTriggerTarget(target.parentElement)};if(getZIndexOfTriggerTarget(e.target),!(targetZIndex>opt.zIndex)){switch(e.keyCode){case 9:case 38:if(handle.keyStop(e,opt),opt.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),opt.$selected&&opt.$selected.find("input, textarea, select").blur(),void(null!==opt.$menu&&void 0!==opt.$menu&&opt.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===opt.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void(null!==opt.$menu&&void 0!==opt.$menu&&opt.$menu.trigger("prevcommand"));break;case 40:if(handle.keyStop(e,opt),!opt.isInput)return void(null!==opt.$menu&&void 0!==opt.$menu&&opt.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),opt.$selected&&opt.$selected.find("input, textarea, select").blur(),void(null!==opt.$menu&&void 0!==opt.$menu&&opt.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===opt.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(handle.keyStop(e,opt),opt.isInput||!opt.$selected||!opt.$selected.length)break;if(!opt.$selected.parent().hasClass("context-menu-root")){var $parent=opt.$selected.parent().parent();return opt.$selected.trigger("contextmenu:blur"),void(opt.$selected=$parent)}break;case 39:if(handle.keyStop(e,opt),opt.isInput||!opt.$selected||!opt.$selected.length)break;var itemdata=opt.$selected.data("contextMenu")||{};if(itemdata.$menu&&opt.$selected.hasClass("context-menu-submenu"))return opt.$selected=null,itemdata.$selected=null,void itemdata.$menu.trigger("nextcommand");break;case 35:case 36:return opt.$selected&&opt.$selected.find("input, textarea, select").length?void 0:((opt.$selected&&opt.$selected.parent()||opt.$menu).children(":not(."+opt.classNames.disabled+", ."+opt.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(handle.keyStop(e,opt),opt.isInput){if(opt.$selected&&!opt.$selected.is("textarea, select"))return void e.preventDefault();break}return void(void 0!==opt.$selected&&null!==opt.$selected&&opt.$selected.trigger("mouseup"));case 32:case 33:case 34:return void handle.keyStop(e,opt);case 27:return handle.keyStop(e,opt),void(null!==opt.$menu&&void 0!==opt.$menu&&opt.$menu.trigger("contextmenu:hide"));default:var k=String.fromCharCode(e.keyCode).toUpperCase();if(opt.accesskeys&&opt.accesskeys[k])return void opt.accesskeys[k].$node.trigger(opt.accesskeys[k].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),void 0!==opt.$selected&&null!==opt.$selected&&opt.$selected.trigger(e)}},prevItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{},root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{},opt.$selected=$s}for(var $children=opt.$menu.children(),$prev=opt.$selected&&opt.$selected.prev().length?opt.$selected.prev():$children.last(),$round=$prev;$prev.hasClass(root.classNames.disabled)||$prev.hasClass(root.classNames.notSelectable)||$prev.is(":hidden");)if($prev=$prev.prev().length?$prev.prev():$children.last(),$prev.is($round))return;opt.$selected&&handle.itemMouseleave.call(opt.$selected.get(0),e),handle.itemMouseenter.call($prev.get(0),e);var $input=$prev.find("input, textarea, select");$input.length&&$input.focus()},nextItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{},root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{},opt.$selected=$s}for(var $children=opt.$menu.children(),$next=opt.$selected&&opt.$selected.next().length?opt.$selected.next():$children.first(),$round=$next;$next.hasClass(root.classNames.disabled)||$next.hasClass(root.classNames.notSelectable)||$next.is(":hidden");)if($next=$next.next().length?$next.next():$children.first(),$next.is($round))return;opt.$selected&&handle.itemMouseleave.call(opt.$selected.get(0),e),handle.itemMouseenter.call($next.get(0),e);var $input=$next.find("input, textarea, select");$input.length&&$input.focus()},focusInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.$selected=opt.$selected=$this,root.isInput=opt.isInput=!0},blurInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu;data.contextMenuRoot.isInput=opt.isInput=!1},menuMouseenter:function(){$(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(e){var root=$(this).data().contextMenuRoot;root.$layer&&root.$layer.is(e.relatedTarget)&&(root.hovering=!1)},itemMouseenter:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(root.hovering=!0,e&&root.$layer&&root.$layer.is(e.relatedTarget)&&(e.preventDefault(),e.stopImmediatePropagation()),(opt.$menu?opt:root).$menu.children("."+root.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),$this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable))return void(opt.$selected=null);$this.trigger("contextmenu:focus")},itemMouseleave:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(root!==opt&&root.$layer&&root.$layer.is(e.relatedTarget))return void 0!==root.$selected&&null!==root.$selected&&root.$selected.trigger("contextmenu:blur"),e.preventDefault(),e.stopImmediatePropagation(),void(root.$selected=opt.$selected=opt.$node);$this.trigger("contextmenu:blur")},itemClick:function(e){var callback,$this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot,key=data.contextMenuKey;if(!(!opt.items[key]||$this.is("."+root.classNames.disabled+", .context-menu-separator, ."+root.classNames.notSelectable)||$this.is(".context-menu-submenu")&&root.selectableSubMenu===!1)){if(e.preventDefault(),e.stopImmediatePropagation(),$.isFunction(opt.callbacks[key])&&Object.prototype.hasOwnProperty.call(opt.callbacks,key))callback=opt.callbacks[key];else{if(!$.isFunction(root.callback))return;callback=root.callback}callback.call(root.$trigger,key,root)!==!1?root.$menu.trigger("contextmenu:hide"):root.$menu.parent().length&&op.update.call(root.$trigger,root)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(e,data){var root=$(this).data("contextMenuRoot");op.hide.call(root.$trigger,root,data&&data.force)},focusItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;$this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)||($this.addClass([root.classNames.hover,root.classNames.visible].join(" ")).parent().find(".context-menu-item").not($this).removeClass(root.classNames.visible).filter("."+root.classNames.hover).trigger("contextmenu:blur"),opt.$selected=root.$selected=$this,opt.$node&&root.positionSubmenu.call(opt.$node,opt.$menu))},blurItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;opt.autoHide&&$this.removeClass(root.classNames.visible),$this.removeClass(root.classNames.hover),opt.$selected=null}},op={show:function(opt,x,y){var $trigger=$(this),css={};if($("#context-menu-layer").trigger("mousedown"),opt.$trigger=$trigger,opt.events.show.call($trigger,opt)===!1)return void($currentTrigger=null);if(op.update.call($trigger,opt),opt.position.call($trigger,opt,x,y),opt.zIndex){var additionalZValue=opt.zIndex;"function"==typeof opt.zIndex&&(additionalZValue=opt.zIndex.call($trigger,opt)),css.zIndex=zindex($trigger)+additionalZValue}op.layer.call(opt.$menu,opt,css.zIndex),opt.$menu.find("ul").css("zIndex",css.zIndex+1),opt.$menu.css(css)[opt.animation.show](opt.animation.duration,function(){$trigger.trigger("contextmenu:visible")}),$trigger.data("contextMenu",opt).addClass("context-menu-active"),$(document).off("keydown.contextMenu").on("keydown.contextMenu",handle.key),opt.autoHide&&$(document).on("mousemove.contextMenuAutoHide",function(e){var pos=$trigger.offset();pos.right=pos.left+$trigger.outerWidth(),pos.bottom=pos.top+$trigger.outerHeight(),!opt.$layer||opt.hovering||e.pageX>=pos.left&&e.pageX<=pos.right&&e.pageY>=pos.top&&e.pageY<=pos.bottom||setTimeout(function(){opt.hovering||null===opt.$menu||void 0===opt.$menu||opt.$menu.trigger("contextmenu:hide")},50)})},hide:function(opt,force){var $trigger=$(this);if(opt||(opt=$trigger.data("contextMenu")||{}),force||!opt.events||opt.events.hide.call($trigger,opt)!==!1){if($trigger.removeData("contextMenu").removeClass("context-menu-active"),opt.$layer){setTimeout(function($layer){return function(){$layer.remove()}}(opt.$layer),10);try{delete opt.$layer}catch(e){opt.$layer=null}}$currentTrigger=null,opt.$menu.find("."+opt.classNames.hover).trigger("contextmenu:blur"),opt.$selected=null,opt.$menu.find("."+opt.classNames.visible).removeClass(opt.classNames.visible),$(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),opt.$menu&&opt.$menu[opt.animation.hide](opt.animation.duration,function(){opt.build&&(opt.$menu.remove(),$.each(opt,function(key){switch(key){case"ns":case"selector":case"build":case"trigger":return!0;default:opt[key]=void 0;try{delete opt[key]}catch(e){}return!0}})),setTimeout(function(){$trigger.trigger("contextmenu:hidden")},10)})}},create:function(opt,root){function createNameNode(item){var $name=$("<span></span>");if(item._accesskey)item._beforeAccesskey&&$name.append(document.createTextNode(item._beforeAccesskey)),$("<span></span>").addClass("context-menu-accesskey").text(item._accesskey).appendTo($name),item._afterAccesskey&&$name.append(document.createTextNode(item._afterAccesskey));else if(item.isHtmlName){if(void 0!==item.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");$name.html(item.name)
}else $name.text(item.name);return $name}void 0===root&&(root=opt),opt.$menu=$('<ul class="context-menu-list"></ul>').addClass(opt.className||"").data({contextMenu:opt,contextMenuRoot:root}),$.each(["callbacks","commands","inputs"],function(i,k){opt[k]={},root[k]||(root[k]={})}),root.accesskeys||(root.accesskeys={}),$.each(opt.items,function(key,item){var $t=$('<li class="context-menu-item"></li>').addClass(item.className||""),$label=null,$input=null;if($t.on("click",$.noop),"string"!=typeof item&&"cm_separator"!==item.type||(item={type:"cm_seperator"}),item.$node=$t.data({contextMenu:opt,contextMenuRoot:root,contextMenuKey:key}),void 0!==item.accesskey)for(var ak,aks=splitAccesskey(item.accesskey),i=0;ak=aks[i];i++)if(!root.accesskeys[ak]){root.accesskeys[ak]=item;var matched=item.name.match(new RegExp("^(.*?)("+ak+")(.*)$","i"));matched&&(item._beforeAccesskey=matched[1],item._accesskey=matched[2],item._afterAccesskey=matched[3]);break}if(item.type&&types[item.type])types[item.type].call($t,item,opt,root),$.each([opt,root],function(i,k){k.commands[key]=item,!$.isFunction(item.callback)||void 0!==k.callbacks[key]&&void 0!==opt.type||(k.callbacks[key]=item.callback)});else{switch("cm_seperator"===item.type?$t.addClass("context-menu-separator "+root.classNames.notSelectable):"html"===item.type?$t.addClass("context-menu-html "+root.classNames.notSelectable):"sub"===item.type||(item.type?($label=$("<label></label>").appendTo($t),createNameNode(item).appendTo($label),$t.addClass("context-menu-input"),opt.hasTypes=!0,$.each([opt,root],function(i,k){k.commands[key]=item,k.inputs[key]=item})):item.items&&(item.type="sub")),item.type){case"cm_seperator":break;case"text":$input=$('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);break;case"textarea":$input=$('<textarea name=""></textarea>').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label),item.height&&$input.height(item.height);break;case"checkbox":$input=$('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"radio":$input=$('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+item.radio).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"select":$input=$('<select name=""></select>').attr("name","context-menu-input-"+key).appendTo($label),item.options&&($.each(item.options,function(value,text){$("<option></option>").val(value).text(text).appendTo($input)}),$input.val(item.selected));break;case"sub":createNameNode(item).appendTo($t),item.appendTo=item.$node,$t.data("contextMenu",item).addClass("context-menu-submenu"),item.callback=null,"function"==typeof item.items.then?op.processPromises(item,root,item.items):op.create(item,root);break;case"html":$(item.html).appendTo($t);break;default:$.each([opt,root],function(i,k){k.commands[key]=item,!$.isFunction(item.callback)||void 0!==k.callbacks[key]&&void 0!==opt.type||(k.callbacks[key]=item.callback)}),createNameNode(item).appendTo($t)}item.type&&"sub"!==item.type&&"html"!==item.type&&"cm_seperator"!==item.type&&($input.on("focus",handle.focusInput).on("blur",handle.blurInput),item.events&&$input.on(item.events,opt)),item.icon&&($.isFunction(item.icon)?item._icon=item.icon.call(this,this,$t,key,item):"string"==typeof item.icon&&"fa-"===item.icon.substring(0,3)?item._icon=root.classNames.icon+" "+root.classNames.icon+"--fa fa "+item.icon:item._icon=root.classNames.icon+" "+root.classNames.icon+"-"+item.icon,$t.addClass(item._icon))}item.$input=$input,item.$label=$label,$t.appendTo(opt.$menu),!opt.hasTypes&&$.support.eventSelectstart&&$t.on("selectstart.disableTextSelect",handle.abortevent)}),opt.$node||opt.$menu.css("display","none").addClass("context-menu-root"),opt.$menu.appendTo(opt.appendTo||document.body)},resize:function($menu,nested){var domMenu;$menu.css({position:"absolute",display:"block"}),$menu.data("width",(domMenu=$menu.get(0)).getBoundingClientRect?Math.ceil(domMenu.getBoundingClientRect().width):$menu.outerWidth()+1),$menu.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),$menu.find("> li > ul").each(function(){op.resize($(this),!0)}),nested||$menu.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return $(this).data("width")})},update:function(opt,root){var $trigger=this;void 0===root&&(root=opt,op.resize(opt.$menu)),opt.$menu.children().each(function(){var visible,$item=$(this),key=$item.data("contextMenuKey"),item=opt.items[key],disabled=$.isFunction(item.disabled)&&item.disabled.call($trigger,key,root)||item.disabled===!0;if(visible=$.isFunction(item.visible)?item.visible.call($trigger,key,root):void 0===item.visible||item.visible===!0,$item[visible?"show":"hide"](),$item[disabled?"addClass":"removeClass"](root.classNames.disabled),$.isFunction(item.icon)&&($item.removeClass(item._icon),item._icon=item.icon.call(this,$trigger,$item,key,item),$item.addClass(item._icon)),item.type)switch($item.find("input, select, textarea").prop("disabled",disabled),item.type){case"text":case"textarea":item.$input.val(item.value||"");break;case"checkbox":case"radio":item.$input.val(item.value||"").prop("checked",!!item.selected);break;case"select":item.$input.val(item.selected||"")}item.$menu&&op.update.call($trigger,item,root)})},layer:function(opt,zIndex){var $layer=opt.$layer=$('<div id="context-menu-layer"></div>').css({height:$win.height(),width:$win.width(),display:"block",position:"fixed","z-index":zIndex,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",opt).insertBefore(this).on("contextmenu",handle.abortevent).on("mousedown",handle.layerClick);return void 0===document.body.style.maxWidth&&$layer.css({position:"absolute",height:$(document).height()}),$layer},processPromises:function(opt,root,promise){function completedPromise(opt,root,items){void 0===items&&errorPromise(void 0),finishPromiseProcess(opt,root,items)}function errorPromise(opt,root,errorItem){void 0===errorItem?(errorItem={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof errorItem&&(errorItem={error:{name:errorItem}}),finishPromiseProcess(opt,root,errorItem)}function finishPromiseProcess(opt,root,items){void 0!==root.$menu&&root.$menu.is(":visible")&&(opt.$node.removeClass(root.classNames.iconLoadingClass),opt.items=items,op.create(opt,root,!0),op.update(opt,root),root.positionSubmenu.call(opt.$node,opt.$menu))}opt.$node.addClass(root.classNames.iconLoadingClass),promise.then(completedPromise.bind(this,opt,root),errorPromise.bind(this,opt,root))}};$.fn.contextMenu=function(operation){var $t=this,$o=operation;if(this.length>0)if(void 0===operation)this.first().trigger("contextmenu");else if(void 0!==operation.x&&void 0!==operation.y)this.first().trigger($.Event("contextmenu",{pageX:operation.x,pageY:operation.y,mouseButton:operation.button}));else if("hide"===operation){var $menu=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;$menu&&$menu.trigger("contextmenu:hide")}else"destroy"===operation?$.contextMenu("destroy",{context:this}):$.isPlainObject(operation)?(operation.context=this,$.contextMenu("create",operation)):operation?this.removeClass("context-menu-disabled"):operation||this.addClass("context-menu-disabled");else $.each(menus,function(){this.selector===$t.selector&&($o.data=this,$.extend($o.data,{trigger:"demand"}))}),handle.contextmenu.call($o.target,$o);return this},$.contextMenu=function(operation,options){"string"!=typeof operation&&(options=operation,operation="create"),"string"==typeof options?options={selector:options}:void 0===options&&(options={});var o=$.extend(!0,{},defaults,options||{}),$document=$(document),$context=$document,_hasContext=!1;switch(o.context&&o.context.length?($context=$(o.context).first(),o.context=$context.get(0),_hasContext=!$(o.context).is(document)):o.context=document,operation){case"create":if(!o.selector)throw new Error("No selector specified");if(o.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className');if(!o.build&&(!o.items||$.isEmptyObject(o.items)))throw new Error("No Items specified");if(counter++,o.ns=".contextMenu"+counter,_hasContext||(namespaces[o.selector]=o.ns),menus[o.ns]=o,o.trigger||(o.trigger="right"),!initialized){var itemClick="click"===o.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",contextMenuItemObj={"contextmenu:focus.contextMenu":handle.focusItem,"contextmenu:blur.contextMenu":handle.blurItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.itemMouseenter,"mouseleave.contextMenu":handle.itemMouseleave};contextMenuItemObj[itemClick]=handle.itemClick,$document.on({"contextmenu:hide.contextMenu":handle.hideMenu,"prevcommand.contextMenu":handle.prevItem,"nextcommand.contextMenu":handle.nextItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.menuMouseenter,"mouseleave.contextMenu":handle.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",handle.inputClick).on(contextMenuItemObj,".context-menu-item"),initialized=!0}switch($context.on("contextmenu"+o.ns,o.selector,o,handle.contextmenu),_hasContext&&$context.on("remove"+o.ns,function(){$(this).contextMenu("destroy")}),o.trigger){case"hover":$context.on("mouseenter"+o.ns,o.selector,o,handle.mouseenter).on("mouseleave"+o.ns,o.selector,o,handle.mouseleave);break;case"left":$context.on("click"+o.ns,o.selector,o,handle.click)}o.build||op.create(o);break;case"destroy":var $visibleMenu;if(_hasContext){var context=o.context;$.each(menus,function(ns,o){if(!o)return!0;if(!$(context).is(o.selector))return!0;$visibleMenu=$(".context-menu-list").filter(":visible"),$visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is($(o.context).find(o.selector))&&$visibleMenu.trigger("contextmenu:hide",{force:!0});try{menus[o.ns].$menu&&menus[o.ns].$menu.remove(),delete menus[o.ns]}catch(e){menus[o.ns]=null}return $(o.context).off(o.ns),!0})}else if(o.selector){if(namespaces[o.selector]){$visibleMenu=$(".context-menu-list").filter(":visible"),$visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is(o.selector)&&$visibleMenu.trigger("contextmenu:hide",{force:!0});try{menus[namespaces[o.selector]].$menu&&menus[namespaces[o.selector]].$menu.remove(),delete menus[namespaces[o.selector]]}catch(e){menus[namespaces[o.selector]]=null}$document.off(namespaces[o.selector])}}else $document.off(".contextMenu .contextMenuAutoHide"),$.each(menus,function(ns,o){$(o.context).off(o.ns)}),namespaces={},menus={},counter=0,initialized=!1,$("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!$.support.htmlCommand&&!$.support.htmlMenuitem||"boolean"==typeof options&&options)&&$('menu[type="context"]').each(function(){this.id&&$.contextMenu({selector:"[contextmenu="+this.id+"]",items:$.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+operation+'"')}return this},$.contextMenu.setInputValues=function(opt,data){void 0===data&&(data={}),$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":item.value=data[key]||"";break;case"checkbox":item.selected=!!data[key];break;case"radio":item.selected=(data[item.radio]||"")===item.value;break;case"select":item.selected=data[key]||""}})},$.contextMenu.getInputValues=function(opt,data){return void 0===data&&(data={}),$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":case"select":data[key]=item.$input.val();break;case"checkbox":data[key]=item.$input.prop("checked");break;case"radio":item.$input.prop("checked")&&(data[item.radio]=item.value)}}),data},$.contextMenu.fromMenu=function(element){var $this=$(element),items={};return menuChildren(items,$this.children()),items},$.contextMenu.defaults=defaults,$.contextMenu.types=types,$.contextMenu.handle=handle,$.contextMenu.op=op,$.contextMenu.menus=menus}),function($){function empty(){}jQuery.event.props.push("dataTransfer");var doc_leave_timer,files,default_opts={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:empty,dragStart:empty,dragEnter:empty,dragOver:empty,dragLeave:empty,docEnter:empty,docOver:empty,docLeave:empty,beforeEach:empty,afterAll:empty,rename:empty,error:function(err,file,i,status){alert(err)},uploadStarted:empty,uploadFinished:empty,progressUpdated:empty,globalProgressUpdated:empty,speedUpdated:empty},errors=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],stop_loop=!1,files_count=0;$.fn.filedrop=function(options){function drop(e){return opts.drop.call(this,e)!==!1&&(null===(files=e.dataTransfer.files)||void 0===files||0===files.length?(opts.error(errors[0]),!1):(files_count=files.length,upload(),e.preventDefault(),!1))}function getBuilder(filename,filedata,mime,boundary){var dashdash="--",crlf="\r\n",builder="";if(opts.data){var params=$.param(opts.data).replace(/\+/g,"%20").split(/&/);$.each(params,function(){var pair=this.split("=",2),name=decodeURIComponent(pair[0]),val=decodeURIComponent(pair[1]);builder+=dashdash,builder+=boundary,builder+=crlf,builder+='Content-Disposition: form-data; name="'+name+'"',builder+=crlf,builder+=crlf,builder+=val,builder+=crlf})}return builder+=dashdash,builder+=boundary,builder+=crlf,builder+='Content-Disposition: form-data; name="'+opts.paramname+'"',builder+='; filename="'+filename+'"',builder+=crlf,builder+="Content-Type: "+mime,builder+=crlf,builder+=crlf,builder+=filedata,builder+=crlf,builder+=dashdash,builder+=boundary,builder+=dashdash,builder+=crlf}function progress(e){if(e.lengthComputable){var percentage=Math.round(100*e.loaded/e.total);if(this.currentProgress!==percentage){this.currentProgress=percentage,opts.progressUpdated(this.index,this.file,this.currentProgress),global_progress[this.global_progress_index]=this.currentProgress,globalProgress();var elapsed=(new Date).getTime(),diffTime=elapsed-this.currentStart;if(diffTime>=opts.refresh){var diffData=e.loaded-this.startData,speed=diffData/diffTime;opts.speedUpdated(this.index,this.file,speed),this.startData=e.loaded,this.currentStart=elapsed}}}}function globalProgress(){if(0!==global_progress.length){var index,total=0;for(index in global_progress)global_progress.hasOwnProperty(index)&&(total+=global_progress[index]);opts.globalProgressUpdated(Math.round(total/global_progress.length))}}function upload(){if(stop_loop=!1,!files)return opts.error(errors[0]),!1;if(opts.allowedfiletypes.push&&opts.allowedfiletypes.length)for(var fileIndex=files.length;fileIndex--;)if(!files[fileIndex].type||$.inArray(files[fileIndex].type,opts.allowedfiletypes)<0)return opts.error(errors[3],files[fileIndex]),!1;var filesDone=0,filesRejected=0;if(files_count>opts.maxfiles&&0===opts.queuefiles)return opts.error(errors[1]),!1;for(var workQueue=[],processingQueue=[],doneQueue=[],i=0;i<files_count;i++)workQueue.push(i);var pause=function(timeout){setTimeout(process,timeout)},process=function(){var fileIndex;if(stop_loop)return!1;if(opts.queuefiles>0&&processingQueue.length>=opts.queuefiles)return pause(opts.queuewait);fileIndex=workQueue[0],workQueue.splice(0,1),processingQueue.push(fileIndex);try{if(beforeEach(files[fileIndex])!==!1){if(fileIndex===files_count)return;var reader=new FileReader,max_file_size=1048576*opts.maxfilesize;if(reader.index=fileIndex,files[fileIndex].size>max_file_size)return opts.error(errors[2],files[fileIndex],fileIndex),processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),filesRejected++,!0;reader.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return opts.error(errors[4]),!1;case e.target.error.NOT_READABLE_ERR:return opts.error(errors[5]),!1;case e.target.error.ABORT_ERR:return opts.error(errors[6]),!1;default:return opts.error(errors[7]),!1}},reader.onloadend=opts.beforeSend?function(e){opts.beforeSend(files[fileIndex],fileIndex,function(){send(e)})}:send,reader.readAsBinaryString(files[fileIndex])}else filesRejected++}catch(err){return processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),opts.error(errors[0]),!1}workQueue.length>0&&process()},send=function(e){var fileIndex=(void 0===e.srcElement?e.target:e.srcElement).index;void 0===e.target.index&&(e.target.index=getIndexBySize(e.total));var builder,xhr=new XMLHttpRequest,upload=xhr.upload,file=files[e.target.index],index=e.target.index,start_time=(new Date).getTime(),boundary="------multipartformboundary"+(new Date).getTime(),global_progress_index=global_progress.length,newName=rename(file.name),mime=file.type;opts.withCredentials&&(xhr.withCredentials=opts.withCredentials),builder="string"==typeof newName?getBuilder(newName,e.target.result,mime,boundary):getBuilder(file.name,e.target.result,mime,boundary),upload.index=index,upload.file=file,upload.downloadStartTime=start_time,upload.currentStart=start_time,upload.currentProgress=0,upload.global_progress_index=global_progress_index,upload.startData=0,upload.addEventListener("progress",progress,!1),jQuery.isFunction(opts.url)?xhr.open("POST",opts.url(),!0):xhr.open("POST",opts.url,!0),xhr.setRequestHeader("content-type","multipart/form-data; boundary="+boundary),$.each(opts.headers,function(k,v){xhr.setRequestHeader(k,v)}),xhr.sendAsBinary(builder),global_progress[global_progress_index]=0,globalProgress(),opts.uploadStarted(index,file,files_count),xhr.onload=function(){var serverResponse=null;if(xhr.responseText)try{serverResponse=jQuery.parseJSON(xhr.responseText)}catch(e){serverResponse=xhr.responseText}var now=(new Date).getTime(),timeDiff=now-start_time,result=opts.uploadFinished(index,file,serverResponse,timeDiff,xhr);filesDone++,processingQueue.forEach(function(value,key){value===fileIndex&&processingQueue.splice(key,1)}),doneQueue.push(fileIndex),global_progress[global_progress_index]=100,globalProgress(),filesDone===files_count-filesRejected&&afterAll(),result===!1&&(stop_loop=!0),(xhr.status<200||xhr.status>299)&&opts.error(xhr.statusText,file,fileIndex,xhr.status)}};process()}function getIndexBySize(size){for(var i=0;i<files_count;i++)if(files[i].size===size)return i}function rename(name){return opts.rename(name)}function beforeEach(file){return opts.beforeEach(file)}function afterAll(){return opts.afterAll()}function dragEnter(e){clearTimeout(doc_leave_timer),e.preventDefault(),opts.dragEnter.call(this,e)}function dragOver(e){clearTimeout(doc_leave_timer),e.preventDefault(),opts.docOver.call(this,e),opts.dragOver.call(this,e)}function dragLeave(e){clearTimeout(doc_leave_timer),opts.dragLeave.call(this,e),e.stopPropagation()}function docDrop(e){return e.preventDefault(),opts.docLeave.call(this,e),!1}function docEnter(e){return clearTimeout(doc_leave_timer),e.preventDefault(),opts.docEnter.call(this,e),!1}function docOver(e){return clearTimeout(doc_leave_timer),e.preventDefault(),opts.docOver.call(this,e),!1}function docLeave(e){doc_leave_timer=setTimeout(function(_this){return function(){opts.docLeave.call(_this,e)}}(this),200)}var opts=$.extend({},default_opts,options),global_progress=[];return this.on("drop",drop).on("dragstart",opts.dragStart).on("dragenter",dragEnter).on("dragover",dragOver).on("dragleave",dragLeave),$(document).on("drop",docDrop).on("dragenter",docEnter).on("dragover",docOver).on("dragleave",docLeave),$("#"+opts.fallback_id).change(function(e){opts.drop(e),files=e.target.files,files_count=files.length,upload()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(datastr){function byteValue(x){return 255&x.charCodeAt(0)}var ords=Array.prototype.map.call(datastr,byteValue),ui8a=new Uint8Array(ords);this.send(ui8a.buffer)}}catch(e){}}(jQuery),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?"undefined"==typeof $?module.exports=factory(require("jquery")):module.exports=factory($):root.bootbox=factory(root.jQuery)}(this,function init($,undefined){"use strict";function _t(key){var locale=locales[defaults.locale];return locale?locale[key]:locales.en[key]}function processCallback(e,dialog,callback){e.stopPropagation(),e.preventDefault(),$.isFunction(callback)&&callback.call(dialog,e)===!1||dialog.modal("hide")}function getKeyLength(obj){if(Object.keys)return Object.keys(obj).length;var k,t=0;for(k in obj)t++;return t}function each(collection,iterator){var index=0;$.each(collection,function(key,value){iterator(key,value,index++)})}function sanitize(options){var buttons,total;if("object"!=typeof options)throw new Error("Please supply an object of options");if(!options.message)throw new Error("Please specify a message");return options=$.extend({},defaults,options),options.buttons||(options.buttons={}),buttons=options.buttons,total=getKeyLength(buttons),each(buttons,function(key,button,index){var isLast=index===total-1;if($.isFunction(button)&&(button=buttons[key]={callback:button}),"object"!==$.type(button))throw new Error("button with key "+key+" must be an object");button.label||(button.label=key),button.className||(button.className=total<=2&&isLast?"btn-primary":"btn-default")}),options}function mapArguments(args,properties){var argn=args.length,options={};if(argn<1||argn>2)throw new Error("Invalid argument length");return 2===argn||"string"==typeof args[0]?(options[properties[0]]=args[0],options[properties[1]]=args[1]):options=args[0],options}function mergeArguments(defaults,args,properties){return $.extend(!0,{},defaults,mapArguments(args,properties))}function mergeDialogOptions(className,labels,properties,args){return validateButtons(mergeArguments({className:"bootbox-"+className,buttons:createLabels.apply(null,labels)},args,properties),labels)}function createLabels(){for(var buttons={},i=0,j=arguments.length;i<j;i++){var argument=arguments[i],key=argument.toLowerCase(),value=argument.toUpperCase();buttons[key]={label:_t(value)}}return buttons}function validateButtons(options,buttons){var allowedButtons={};return each(buttons,function(key,value){allowedButtons[value]=!0}),each(options.buttons,function(key){if(allowedButtons[key]===undefined)throw new Error("button key "+key+" is not allowed (options are "+buttons.join("\n")+")")}),options}var templates={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog' aria-hidden='true'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},defaults={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},exports={};exports.alert=function(){var options;if(options=mergeDialogOptions("alert",["ok"],["message","callback"],arguments),options.callback&&!$.isFunction(options.callback))throw new Error("alert requires callback property to be a function when provided");return options.buttons.ok.callback=options.onEscape=function(){return!$.isFunction(options.callback)||options.callback.call(this)},exports.dialog(options)},exports.confirm=function(){var options;if(options=mergeDialogOptions("confirm",["cancel","confirm"],["message","callback"],arguments),!$.isFunction(options.callback))throw new Error("confirm requires a callback");return options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,!1)},options.buttons.confirm.callback=function(){return options.callback.call(this,!0)},exports.dialog(options)},exports.prompt=function(){var options,defaults,dialog,form,input,shouldShow,inputOptions;if(form=$(templates.form),defaults={className:"bootbox-prompt",buttons:createLabels("cancel","confirm"),value:"",inputType:"text"},options=validateButtons(mergeArguments(defaults,arguments,["title","callback"]),["cancel","confirm"]),shouldShow=options.show===undefined||options.show,options.message=form,options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,null)},options.buttons.confirm.callback=function(){var value;return value="checkbox"===options.inputType?input.find("input:checked").map(function(){return $(this).val()}).get():input.val(),options.callback.call(this,value)},options.show=!1,!options.title)throw new Error("prompt requires a title");if(!$.isFunction(options.callback))throw new Error("prompt requires a callback");if(!templates.inputs[options.inputType])throw new Error("invalid prompt type");switch(input=$(templates.inputs[options.inputType]),options.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":input.val(options.value);break;case"select":var groups={};if(inputOptions=options.inputOptions||[],!$.isArray(inputOptions))throw new Error("Please pass an array of input options");if(!inputOptions.length)throw new Error("prompt with select requires options");each(inputOptions,function(_,option){var elem=input;if(option.value===undefined||option.text===undefined)throw new Error("each option needs a `value` and a `text` property");option.group&&(groups[option.group]||(groups[option.group]=$("<optgroup/>").attr("label",option.group)),elem=groups[option.group]),elem.append("<option value='"+option.value+"'>"+option.text+"</option>")}),each(groups,function(_,group){input.append(group)}),input.val(options.value);break;case"checkbox":var values=$.isArray(options.value)?options.value:[options.value];if(inputOptions=options.inputOptions||[],!inputOptions.length)throw new Error("prompt with checkbox requires options");if(!inputOptions[0].value||!inputOptions[0].text)throw new Error("each option needs a `value` and a `text` property");input=$("<div/>"),each(inputOptions,function(_,option){var checkbox=$(templates.inputs[options.inputType]);checkbox.find("input").attr("value",option.value),checkbox.find("label").append(option.text),each(values,function(_,value){value===option.value&&checkbox.find("input").prop("checked",!0)}),input.append(checkbox)})}return options.placeholder&&input.attr("placeholder",options.placeholder),options.pattern&&input.attr("pattern",options.pattern),options.maxlength&&input.attr("maxlength",options.maxlength),form.append(input),form.on("submit",function(e){e.preventDefault(),e.stopPropagation(),dialog.find(".btn-primary").click()}),dialog=exports.dialog(options),dialog.off("shown.bs.modal"),dialog.on("shown.bs.modal",function(){input.focus()}),shouldShow===!0&&dialog.modal("show"),dialog},exports.dialog=function(options){options=sanitize(options);var dialog=$(templates.dialog),innerDialog=dialog.find(".modal-dialog"),body=dialog.find(".modal-body"),buttons=options.buttons,buttonStr="",callbacks={onEscape:options.onEscape};if($.fn.modal===undefined)throw new Error("$.fn.modal is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.");if(each(buttons,function(key,button){buttonStr+="<button data-bb-handler='"+key+"' type='button' class='btn "+button.className+"'>"+button.label+"</button>",callbacks[key]=button.callback}),body.find(".bootbox-body").html(options.message),options.animate===!0&&dialog.addClass("fade"),options.className&&dialog.addClass(options.className),"large"===options.size?innerDialog.addClass("modal-lg"):"small"===options.size&&innerDialog.addClass("modal-sm"),options.title&&body.before(templates.header),options.closeButton){var closeButton=$(templates.closeButton);options.title?dialog.find(".modal-header").prepend(closeButton):closeButton.css("margin-top","-2px").prependTo(body)}return options.title&&dialog.find(".modal-title").html(options.title),buttonStr.length&&(body.after(templates.footer),dialog.find(".modal-footer").html(buttonStr)),dialog.one("hide.bs.modal",function(){dialog.off("escape.close.bb"),dialog.off("click")}),dialog.one("hidden.bs.modal",function(e){e.target===this&&dialog.remove()}),dialog.one("shown.bs.modal",function(){dialog.find(".btn-primary:first").focus()}),"static"!==options.backdrop&&dialog.on("click.dismiss.bs.modal",function(e){dialog.children(".modal-backdrop").length&&(e.currentTarget=dialog.children(".modal-backdrop").get(0)),e.target===e.currentTarget&&dialog.trigger("escape.close.bb")}),dialog.on("escape.close.bb",function(e){callbacks.onEscape&&processCallback(e,dialog,callbacks.onEscape)}),dialog.on("click",".modal-footer button",function(e){var callbackKey=$(this).data("bb-handler");processCallback(e,dialog,callbacks[callbackKey])}),dialog.on("click",".bootbox-close-button",function(e){processCallback(e,dialog,callbacks.onEscape)}),dialog.on("keyup",function(e){27===e.which&&dialog.trigger("escape.close.bb")}),$(options.container).append(dialog),dialog.modal({backdrop:!!options.backdrop&&"static",keyboard:!1,show:!1}),options.show&&dialog.modal("show"),dialog},exports.setDefaults=function(){var values={};2===arguments.length?values[arguments[0]]=arguments[1]:values=arguments[0],$.extend(defaults,values)},exports.hideAll=function(){return $(".bootbox").modal("hide"),exports};var locales={ar:{OK:"",CANCEL:"",CONFIRM:""},bg_BG:{OK:"",CANCEL:"",CONFIRM:""},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zruit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"",CANCEL:"",CONFIRM:""},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},eu:{OK:"OK",CANCEL:"Ezeztatu",CONFIRM:"Onartu"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"",CANCEL:"",CONFIRM:""},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"Confirmer"},he:{OK:"",CANCEL:"",CONFIRM:""},hu:{OK:"OK",CANCEL:"Mgsem",CONFIRM:"Megerst"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"",CONFIRM:""},lt:{OK:"Gerai",CANCEL:"Ataukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprint"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierd"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"",
CONFIRM:""},sl:{OK:"OK",CANCEL:"Preklii",CONFIRM:"Potrdi"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"",CANCEL:"",CONFIRM:""},tr:{OK:"Tamam",CANCEL:"ptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"",CONFIRM:""},zh_TW:{OK:"OK",CANCEL:"",CONFIRM:""}};return exports.addLocale=function(name,values){return $.each(["OK","CANCEL","CONFIRM"],function(_,v){if(!values[v])throw new Error("Please supply a translation for '"+v+"'")}),locales[name]={OK:values.OK,CANCEL:values.CANCEL,CONFIRM:values.CONFIRM},exports},exports.removeLocale=function(name){return delete locales[name],exports},exports.setLocale=function(name){return exports.setDefaults("locale",name)},exports.init=function(_$){return init(_$||$)},exports}),jQuery.uiDivFilter=function(jq,phrase,ifHidden,ifShown){if(this.last_phrase===phrase)return!1;var phrase_length=phrase.length,words=phrase.toLowerCase().split(" "),search_text=function(){var elem=jQuery(this);jQuery.uiDivFilter.has_words(elem.text(),words)?(elem.show(),ifShown&&ifShown(elem)):(elem.hide(),ifHidden&&ifHidden(elem))};return words.length>1&&phrase.substr(0,phrase_length-1)===this.last_phrase?(words=words[words.length-1],this.last_phrase=phrase,jq.filter(":visible").each(search_text)):(this.last_phrase=phrase,jq.each(search_text)),jq},jQuery.uiDivFilter.last_phrase="",jQuery.uiDivFilter.has_words=function(str,words,caseSensitive){for(var text=caseSensitive?str:str.toLowerCase(),i=0;i<words.length;i++)if(text.indexOf(words[i])===-1)return!1;return!0};